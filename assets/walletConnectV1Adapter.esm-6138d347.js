import{b as Wt,d as jr,c as At,B as zt,ae as Dr,af as Xe,C as Qt,_ as xt,W as Jt,A as Hr,u as $r,v as It,x as Ot,w as qt,y as kt,z as Zr,D as Kt,M as Jr}from"./index-6f172409.js";import{B as Gr}from"./baseEvmAdapter.esm-5e3e671c.js";import{WalletConnectProvider as tr}from"./ethereumProvider.esm-21c6588e.js";var xe={},P={};Object.defineProperty(P,"__esModule",{value:!0});var mr=P.getLocalStorage=P.getLocalStorageOrThrow=P.getCrypto=P.getCryptoOrThrow=wr=P.getLocation=P.getLocationOrThrow=yr=P.getNavigator=P.getNavigatorOrThrow=P.getDocument=P.getDocumentOrThrow=P.getFromWindowOrThrow=P.getFromWindow=void 0;function Ut(i){let r;return typeof window<"u"&&typeof window[i]<"u"&&(r=window[i]),r}P.getFromWindow=Ut;function Ht(i){const r=Ut(i);if(!r)throw new Error(`${i} is not defined in Window`);return r}P.getFromWindowOrThrow=Ht;function Kr(){return Ht("document")}P.getDocumentOrThrow=Kr;function Vr(){return Ut("document")}P.getDocument=Vr;function zr(){return Ht("navigator")}P.getNavigatorOrThrow=zr;function Qr(){return Ut("navigator")}var yr=P.getNavigator=Qr;function Yr(){return Ht("location")}P.getLocationOrThrow=Yr;function Xr(){return Ut("location")}var wr=P.getLocation=Xr;function tn(){return Ht("crypto")}P.getCryptoOrThrow=tn;function en(){return Ut("crypto")}P.getCrypto=en;function rn(){return Ht("localStorage")}P.getLocalStorageOrThrow=rn;function nn(){return Ut("localStorage")}mr=P.getLocalStorage=nn;Object.defineProperty(xe,"__esModule",{value:!0});var _r=xe.getWindowMetadata=void 0;const er=P;function sn(){let i,r;try{i=er.getDocumentOrThrow(),r=er.getLocationOrThrow()}catch{return null}function a(){const A=i.getElementsByTagName("link"),F=[];for(let W=0;W<A.length;W++){const Mt=A[W],Rt=Mt.getAttribute("rel");if(Rt&&Rt.toLowerCase().indexOf("icon")>-1){const m=Mt.getAttribute("href");if(m)if(m.toLowerCase().indexOf("https:")===-1&&m.toLowerCase().indexOf("http:")===-1&&m.indexOf("//")!==0){let y=r.protocol+"//"+r.host;if(m.indexOf("/")===0)y+=m;else{const b=r.pathname.split("/");b.pop();const w=b.join("/");y+=w+"/"+m}F.push(y)}else if(m.indexOf("//")===0){const y=r.protocol+m;F.push(y)}else F.push(m)}}return F}function d(...A){const F=i.getElementsByTagName("meta");for(let W=0;W<F.length;W++){const Mt=F[W],Rt=["itemprop","property","name"].map(m=>Mt.getAttribute(m)).filter(m=>m?A.includes(m):!1);if(Rt.length&&Rt){const m=Mt.getAttribute("content");if(m)return m}}return""}function v(){let A=d("name","og:site_name","og:title","twitter:title");return A||(A=i.title),A}function l(){return d("description","og:description","twitter:description","keywords")}const R=v(),T=l(),I=r.origin,U=a();return{description:T,url:I,icons:U,name:R}}_r=xe.getWindowMetadata=sn;var on=globalThis&&globalThis.__spreadArrays||function(){for(var i=0,r=0,a=arguments.length;r<a;r++)i+=arguments[r].length;for(var d=Array(i),v=0,r=0;r<a;r++)for(var l=arguments[r],R=0,T=l.length;R<T;R++,v++)d[v]=l[R];return d},an=function(){function i(r,a,d){this.name=r,this.version=a,this.os=d,this.type="browser"}return i}(),hn=function(){function i(r){this.version=r,this.type="node",this.name="node",this.os=Wt.platform}return i}(),fn=function(){function i(r,a,d,v){this.name=r,this.version=a,this.os=d,this.bot=v,this.type="bot-device"}return i}(),cn=function(){function i(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return i}(),un=function(){function i(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return i}(),ln=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,dn=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,rr=3,pn=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",ln]],nr=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function gn(i){return i?ir(i):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new un:typeof navigator<"u"?ir(navigator.userAgent):yn()}function vn(i){return i!==""&&pn.reduce(function(r,a){var d=a[0],v=a[1];if(r)return r;var l=v.exec(i);return!!l&&[d,l]},!1)}function ir(i){var r=vn(i);if(!r)return null;var a=r[0],d=r[1];if(a==="searchbot")return new cn;var v=d[1]&&d[1].split(/[._]/).slice(0,3);v?v.length<rr&&(v=on(v,wn(rr-v.length))):v=[];var l=v.join("."),R=mn(i),T=dn.exec(i);return T&&T[1]?new fn(a,l,R,T[1]):new an(a,l,R)}function mn(i){for(var r=0,a=nr.length;r<a;r++){var d=nr[r],v=d[0],l=d[1],R=l.exec(i);if(R)return v}return null}function yn(){var i=typeof Wt<"u"&&Wt.version;return i?new hn(Wt.version.slice(1)):null}function wn(i){for(var r=[],a=0;a<i;a++)r.push("0");return r}function ke(i){return gn(i)}function Te(){const i=ke();return i&&i.os?i.os:void 0}function _n(){const i=Te();return i?i.toLowerCase().includes("android"):!1}function Mn(){const i=Te();return i?i.toLowerCase().includes("ios")||i.toLowerCase().includes("mac")&&navigator.maxTouchPoints>1:!1}function bn(){return Te()?_n()||Mn():!1}function Sn(){const i=ke();return i&&i.name?i.name.toLowerCase()==="node":!1}function Rn(){return!Sn()&&!!En()}const En=yr,In=wr,Ce=mr;function sr(){return _r()}function On(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return JSON.parse(i)}catch{return i}}function xn(i){return typeof i=="string"?i:JSON.stringify(i)}const kn=On,Tn=xn;function Cn(i,r){const a=Tn(r),d=Ce();d&&d.setItem(i,a)}function Mr(i){let r=null,a=null;const d=Ce();return d&&(a=d.getItem(i)),r=a&&kn(a),r}function br(i){const r=Ce();r&&r.removeItem(i)}const or="WALLETCONNECT_DEEPLINK_CHOICE",An=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],Sr=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];var Se={},Nn={get exports(){return Se},set exports(i){Se=i}};(function(i){(function(r,a){function d(h,t){if(!h)throw new Error(t||"Assertion failed")}function v(h,t){h.super_=t;var n=function(){};n.prototype=t.prototype,h.prototype=new n,h.prototype.constructor=h}function l(h,t,n){if(l.isBN(h))return h;this.negative=0,this.words=null,this.length=0,this.red=null,h!==null&&((t==="le"||t==="be")&&(n=t,t=10),this._init(h||0,t||10,n||"be"))}typeof r=="object"?r.exports=l:a.BN=l,l.BN=l,l.wordSize=26;var R;try{R=jr.Buffer}catch{}l.isBN=function(t){return t instanceof l?!0:t!==null&&typeof t=="object"&&t.constructor.wordSize===l.wordSize&&Array.isArray(t.words)},l.max=function(t,n){return t.cmp(n)>0?t:n},l.min=function(t,n){return t.cmp(n)<0?t:n},l.prototype._init=function(t,n,s){if(typeof t=="number")return this._initNumber(t,n,s);if(typeof t=="object")return this._initArray(t,n,s);n==="hex"&&(n=16),d(n===(n|0)&&n>=2&&n<=36),t=t.toString().replace(/\s+/g,"");var o=0;t[0]==="-"&&o++,n===16?this._parseHex(t,o):this._parseBase(t,n,o),t[0]==="-"&&(this.negative=1),this.strip(),s==="le"&&this._initArray(this.toArray(),n,s)},l.prototype._initNumber=function(t,n,s){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[t&67108863],this.length=1):t<4503599627370496?(this.words=[t&67108863,t/67108864&67108863],this.length=2):(d(t<9007199254740992),this.words=[t&67108863,t/67108864&67108863,1],this.length=3),s==="le"&&this._initArray(this.toArray(),n,s)},l.prototype._initArray=function(t,n,s){if(d(typeof t.length=="number"),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var o=0;o<this.length;o++)this.words[o]=0;var f,p,g=0;if(s==="be")for(o=t.length-1,f=0;o>=0;o-=3)p=t[o]|t[o-1]<<8|t[o-2]<<16,this.words[f]|=p<<g&67108863,this.words[f+1]=p>>>26-g&67108863,g+=24,g>=26&&(g-=26,f++);else if(s==="le")for(o=0,f=0;o<t.length;o+=3)p=t[o]|t[o+1]<<8|t[o+2]<<16,this.words[f]|=p<<g&67108863,this.words[f+1]=p>>>26-g&67108863,g+=24,g>=26&&(g-=26,f++);return this.strip()};function T(h,t,n){for(var s=0,o=Math.min(h.length,n),f=t;f<o;f++){var p=h.charCodeAt(f)-48;s<<=4,p>=49&&p<=54?s|=p-49+10:p>=17&&p<=22?s|=p-17+10:s|=p&15}return s}l.prototype._parseHex=function(t,n){this.length=Math.ceil((t.length-n)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var o,f,p=0;for(s=t.length-6,o=0;s>=n;s-=6)f=T(t,s,s+6),this.words[o]|=f<<p&67108863,this.words[o+1]|=f>>>26-p&4194303,p+=24,p>=26&&(p-=26,o++);s+6!==n&&(f=T(t,n,s+6),this.words[o]|=f<<p&67108863,this.words[o+1]|=f>>>26-p&4194303),this.strip()};function I(h,t,n,s){for(var o=0,f=Math.min(h.length,n),p=t;p<f;p++){var g=h.charCodeAt(p)-48;o*=s,g>=49?o+=g-49+10:g>=17?o+=g-17+10:o+=g}return o}l.prototype._parseBase=function(t,n,s){this.words=[0],this.length=1;for(var o=0,f=1;f<=67108863;f*=n)o++;o--,f=f/n|0;for(var p=t.length-s,g=p%o,c=Math.min(p,p-g)+s,e=0,u=s;u<c;u+=o)e=I(t,u,u+o,n),this.imuln(f),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e);if(g!==0){var M=1;for(e=I(t,u,t.length,n),u=0;u<g;u++)M*=n;this.imuln(M),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e)}},l.prototype.copy=function(t){t.words=new Array(this.length);for(var n=0;n<this.length;n++)t.words[n]=this.words[n];t.length=this.length,t.negative=this.negative,t.red=this.red},l.prototype.clone=function(){var t=new l(null);return this.copy(t),t},l.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},l.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},l.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},l.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var U=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],bt=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],A=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];l.prototype.toString=function(t,n){t=t||10,n=n|0||1;var s;if(t===16||t==="hex"){s="";for(var o=0,f=0,p=0;p<this.length;p++){var g=this.words[p],c=((g<<o|f)&16777215).toString(16);f=g>>>24-o&16777215,f!==0||p!==this.length-1?s=U[6-c.length]+c+s:s=c+s,o+=2,o>=26&&(o-=26,p--)}for(f!==0&&(s=f.toString(16)+s);s.length%n!==0;)s="0"+s;return this.negative!==0&&(s="-"+s),s}if(t===(t|0)&&t>=2&&t<=36){var e=bt[t],u=A[t];s="";var M=this.clone();for(M.negative=0;!M.isZero();){var _=M.modn(u).toString(t);M=M.idivn(u),M.isZero()?s=_+s:s=U[e-_.length]+_+s}for(this.isZero()&&(s="0"+s);s.length%n!==0;)s="0"+s;return this.negative!==0&&(s="-"+s),s}d(!1,"Base should be between 2 and 36")},l.prototype.toNumber=function(){var t=this.words[0];return this.length===2?t+=this.words[1]*67108864:this.length===3&&this.words[2]===1?t+=4503599627370496+this.words[1]*67108864:this.length>2&&d(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-t:t},l.prototype.toJSON=function(){return this.toString(16)},l.prototype.toBuffer=function(t,n){return d(typeof R<"u"),this.toArrayLike(R,t,n)},l.prototype.toArray=function(t,n){return this.toArrayLike(Array,t,n)},l.prototype.toArrayLike=function(t,n,s){var o=this.byteLength(),f=s||Math.max(1,o);d(o<=f,"byte array longer than desired length"),d(f>0,"Requested array length <= 0"),this.strip();var p=n==="le",g=new t(f),c,e,u=this.clone();if(p){for(e=0;!u.isZero();e++)c=u.andln(255),u.iushrn(8),g[e]=c;for(;e<f;e++)g[e]=0}else{for(e=0;e<f-o;e++)g[e]=0;for(e=0;!u.isZero();e++)c=u.andln(255),u.iushrn(8),g[f-e-1]=c}return g},Math.clz32?l.prototype._countBits=function(t){return 32-Math.clz32(t)}:l.prototype._countBits=function(t){var n=t,s=0;return n>=4096&&(s+=13,n>>>=13),n>=64&&(s+=7,n>>>=7),n>=8&&(s+=4,n>>>=4),n>=2&&(s+=2,n>>>=2),s+n},l.prototype._zeroBits=function(t){if(t===0)return 26;var n=t,s=0;return n&8191||(s+=13,n>>>=13),n&127||(s+=7,n>>>=7),n&15||(s+=4,n>>>=4),n&3||(s+=2,n>>>=2),n&1||s++,s},l.prototype.bitLength=function(){var t=this.words[this.length-1],n=this._countBits(t);return(this.length-1)*26+n};function F(h){for(var t=new Array(h.bitLength()),n=0;n<t.length;n++){var s=n/26|0,o=n%26;t[n]=(h.words[s]&1<<o)>>>o}return t}l.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,n=0;n<this.length;n++){var s=this._zeroBits(this.words[n]);if(t+=s,s!==26)break}return t},l.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},l.prototype.toTwos=function(t){return this.negative!==0?this.abs().inotn(t).iaddn(1):this.clone()},l.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},l.prototype.isNeg=function(){return this.negative!==0},l.prototype.neg=function(){return this.clone().ineg()},l.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},l.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var n=0;n<t.length;n++)this.words[n]=this.words[n]|t.words[n];return this.strip()},l.prototype.ior=function(t){return d((this.negative|t.negative)===0),this.iuor(t)},l.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},l.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},l.prototype.iuand=function(t){var n;this.length>t.length?n=t:n=this;for(var s=0;s<n.length;s++)this.words[s]=this.words[s]&t.words[s];return this.length=n.length,this.strip()},l.prototype.iand=function(t){return d((this.negative|t.negative)===0),this.iuand(t)},l.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},l.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},l.prototype.iuxor=function(t){var n,s;this.length>t.length?(n=this,s=t):(n=t,s=this);for(var o=0;o<s.length;o++)this.words[o]=n.words[o]^s.words[o];if(this!==n)for(;o<n.length;o++)this.words[o]=n.words[o];return this.length=n.length,this.strip()},l.prototype.ixor=function(t){return d((this.negative|t.negative)===0),this.iuxor(t)},l.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},l.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},l.prototype.inotn=function(t){d(typeof t=="number"&&t>=0);var n=Math.ceil(t/26)|0,s=t%26;this._expand(n),s>0&&n--;for(var o=0;o<n;o++)this.words[o]=~this.words[o]&67108863;return s>0&&(this.words[o]=~this.words[o]&67108863>>26-s),this.strip()},l.prototype.notn=function(t){return this.clone().inotn(t)},l.prototype.setn=function(t,n){d(typeof t=="number"&&t>=0);var s=t/26|0,o=t%26;return this._expand(s+1),n?this.words[s]=this.words[s]|1<<o:this.words[s]=this.words[s]&~(1<<o),this.strip()},l.prototype.iadd=function(t){var n;if(this.negative!==0&&t.negative===0)return this.negative=0,n=this.isub(t),this.negative^=1,this._normSign();if(this.negative===0&&t.negative!==0)return t.negative=0,n=this.isub(t),t.negative=1,n._normSign();var s,o;this.length>t.length?(s=this,o=t):(s=t,o=this);for(var f=0,p=0;p<o.length;p++)n=(s.words[p]|0)+(o.words[p]|0)+f,this.words[p]=n&67108863,f=n>>>26;for(;f!==0&&p<s.length;p++)n=(s.words[p]|0)+f,this.words[p]=n&67108863,f=n>>>26;if(this.length=s.length,f!==0)this.words[this.length]=f,this.length++;else if(s!==this)for(;p<s.length;p++)this.words[p]=s.words[p];return this},l.prototype.add=function(t){var n;return t.negative!==0&&this.negative===0?(t.negative=0,n=this.sub(t),t.negative^=1,n):t.negative===0&&this.negative!==0?(this.negative=0,n=t.sub(this),this.negative=1,n):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},l.prototype.isub=function(t){if(t.negative!==0){t.negative=0;var n=this.iadd(t);return t.negative=1,n._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var s=this.cmp(t);if(s===0)return this.negative=0,this.length=1,this.words[0]=0,this;var o,f;s>0?(o=this,f=t):(o=t,f=this);for(var p=0,g=0;g<f.length;g++)n=(o.words[g]|0)-(f.words[g]|0)+p,p=n>>26,this.words[g]=n&67108863;for(;p!==0&&g<o.length;g++)n=(o.words[g]|0)+p,p=n>>26,this.words[g]=n&67108863;if(p===0&&g<o.length&&o!==this)for(;g<o.length;g++)this.words[g]=o.words[g];return this.length=Math.max(this.length,g),o!==this&&(this.negative=1),this.strip()},l.prototype.sub=function(t){return this.clone().isub(t)};function W(h,t,n){n.negative=t.negative^h.negative;var s=h.length+t.length|0;n.length=s,s=s-1|0;var o=h.words[0]|0,f=t.words[0]|0,p=o*f,g=p&67108863,c=p/67108864|0;n.words[0]=g;for(var e=1;e<s;e++){for(var u=c>>>26,M=c&67108863,_=Math.min(e,t.length-1),S=Math.max(0,e-h.length+1);S<=_;S++){var O=e-S|0;o=h.words[O]|0,f=t.words[S]|0,p=o*f+M,u+=p/67108864|0,M=p&67108863}n.words[e]=M|0,c=u|0}return c!==0?n.words[e]=c|0:n.length--,n.strip()}var Mt=function(t,n,s){var o=t.words,f=n.words,p=s.words,g=0,c,e,u,M=o[0]|0,_=M&8191,S=M>>>13,O=o[1]|0,C=O&8191,N=O>>>13,Nt=o[2]|0,q=Nt&8191,L=Nt>>>13,Be=o[3]|0,j=Be&8191,D=Be>>>13,Le=o[4]|0,H=Le&8191,$=Le>>>13,We=o[5]|0,Z=We&8191,J=We>>>13,Ue=o[6]|0,G=Ue&8191,K=Ue>>>13,Fe=o[7]|0,V=Fe&8191,z=Fe>>>13,je=o[8]|0,Q=je&8191,Y=je>>>13,De=o[9]|0,X=De&8191,tt=De>>>13,He=f[0]|0,et=He&8191,rt=He>>>13,$e=f[1]|0,nt=$e&8191,it=$e>>>13,Ze=f[2]|0,st=Ze&8191,ot=Ze>>>13,Je=f[3]|0,at=Je&8191,ht=Je>>>13,Ge=f[4]|0,ft=Ge&8191,ct=Ge>>>13,Ke=f[5]|0,ut=Ke&8191,lt=Ke>>>13,Ve=f[6]|0,dt=Ve&8191,pt=Ve>>>13,ze=f[7]|0,gt=ze&8191,vt=ze>>>13,Qe=f[8]|0,mt=Qe&8191,yt=Qe>>>13,Ye=f[9]|0,wt=Ye&8191,_t=Ye>>>13;s.negative=t.negative^n.negative,s.length=19,c=Math.imul(_,et),e=Math.imul(_,rt),e=e+Math.imul(S,et)|0,u=Math.imul(S,rt);var ee=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ee>>>26)|0,ee&=67108863,c=Math.imul(C,et),e=Math.imul(C,rt),e=e+Math.imul(N,et)|0,u=Math.imul(N,rt),c=c+Math.imul(_,nt)|0,e=e+Math.imul(_,it)|0,e=e+Math.imul(S,nt)|0,u=u+Math.imul(S,it)|0;var re=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(re>>>26)|0,re&=67108863,c=Math.imul(q,et),e=Math.imul(q,rt),e=e+Math.imul(L,et)|0,u=Math.imul(L,rt),c=c+Math.imul(C,nt)|0,e=e+Math.imul(C,it)|0,e=e+Math.imul(N,nt)|0,u=u+Math.imul(N,it)|0,c=c+Math.imul(_,st)|0,e=e+Math.imul(_,ot)|0,e=e+Math.imul(S,st)|0,u=u+Math.imul(S,ot)|0;var ne=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ne>>>26)|0,ne&=67108863,c=Math.imul(j,et),e=Math.imul(j,rt),e=e+Math.imul(D,et)|0,u=Math.imul(D,rt),c=c+Math.imul(q,nt)|0,e=e+Math.imul(q,it)|0,e=e+Math.imul(L,nt)|0,u=u+Math.imul(L,it)|0,c=c+Math.imul(C,st)|0,e=e+Math.imul(C,ot)|0,e=e+Math.imul(N,st)|0,u=u+Math.imul(N,ot)|0,c=c+Math.imul(_,at)|0,e=e+Math.imul(_,ht)|0,e=e+Math.imul(S,at)|0,u=u+Math.imul(S,ht)|0;var ie=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ie>>>26)|0,ie&=67108863,c=Math.imul(H,et),e=Math.imul(H,rt),e=e+Math.imul($,et)|0,u=Math.imul($,rt),c=c+Math.imul(j,nt)|0,e=e+Math.imul(j,it)|0,e=e+Math.imul(D,nt)|0,u=u+Math.imul(D,it)|0,c=c+Math.imul(q,st)|0,e=e+Math.imul(q,ot)|0,e=e+Math.imul(L,st)|0,u=u+Math.imul(L,ot)|0,c=c+Math.imul(C,at)|0,e=e+Math.imul(C,ht)|0,e=e+Math.imul(N,at)|0,u=u+Math.imul(N,ht)|0,c=c+Math.imul(_,ft)|0,e=e+Math.imul(_,ct)|0,e=e+Math.imul(S,ft)|0,u=u+Math.imul(S,ct)|0;var se=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(se>>>26)|0,se&=67108863,c=Math.imul(Z,et),e=Math.imul(Z,rt),e=e+Math.imul(J,et)|0,u=Math.imul(J,rt),c=c+Math.imul(H,nt)|0,e=e+Math.imul(H,it)|0,e=e+Math.imul($,nt)|0,u=u+Math.imul($,it)|0,c=c+Math.imul(j,st)|0,e=e+Math.imul(j,ot)|0,e=e+Math.imul(D,st)|0,u=u+Math.imul(D,ot)|0,c=c+Math.imul(q,at)|0,e=e+Math.imul(q,ht)|0,e=e+Math.imul(L,at)|0,u=u+Math.imul(L,ht)|0,c=c+Math.imul(C,ft)|0,e=e+Math.imul(C,ct)|0,e=e+Math.imul(N,ft)|0,u=u+Math.imul(N,ct)|0,c=c+Math.imul(_,ut)|0,e=e+Math.imul(_,lt)|0,e=e+Math.imul(S,ut)|0,u=u+Math.imul(S,lt)|0;var oe=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(oe>>>26)|0,oe&=67108863,c=Math.imul(G,et),e=Math.imul(G,rt),e=e+Math.imul(K,et)|0,u=Math.imul(K,rt),c=c+Math.imul(Z,nt)|0,e=e+Math.imul(Z,it)|0,e=e+Math.imul(J,nt)|0,u=u+Math.imul(J,it)|0,c=c+Math.imul(H,st)|0,e=e+Math.imul(H,ot)|0,e=e+Math.imul($,st)|0,u=u+Math.imul($,ot)|0,c=c+Math.imul(j,at)|0,e=e+Math.imul(j,ht)|0,e=e+Math.imul(D,at)|0,u=u+Math.imul(D,ht)|0,c=c+Math.imul(q,ft)|0,e=e+Math.imul(q,ct)|0,e=e+Math.imul(L,ft)|0,u=u+Math.imul(L,ct)|0,c=c+Math.imul(C,ut)|0,e=e+Math.imul(C,lt)|0,e=e+Math.imul(N,ut)|0,u=u+Math.imul(N,lt)|0,c=c+Math.imul(_,dt)|0,e=e+Math.imul(_,pt)|0,e=e+Math.imul(S,dt)|0,u=u+Math.imul(S,pt)|0;var ae=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ae>>>26)|0,ae&=67108863,c=Math.imul(V,et),e=Math.imul(V,rt),e=e+Math.imul(z,et)|0,u=Math.imul(z,rt),c=c+Math.imul(G,nt)|0,e=e+Math.imul(G,it)|0,e=e+Math.imul(K,nt)|0,u=u+Math.imul(K,it)|0,c=c+Math.imul(Z,st)|0,e=e+Math.imul(Z,ot)|0,e=e+Math.imul(J,st)|0,u=u+Math.imul(J,ot)|0,c=c+Math.imul(H,at)|0,e=e+Math.imul(H,ht)|0,e=e+Math.imul($,at)|0,u=u+Math.imul($,ht)|0,c=c+Math.imul(j,ft)|0,e=e+Math.imul(j,ct)|0,e=e+Math.imul(D,ft)|0,u=u+Math.imul(D,ct)|0,c=c+Math.imul(q,ut)|0,e=e+Math.imul(q,lt)|0,e=e+Math.imul(L,ut)|0,u=u+Math.imul(L,lt)|0,c=c+Math.imul(C,dt)|0,e=e+Math.imul(C,pt)|0,e=e+Math.imul(N,dt)|0,u=u+Math.imul(N,pt)|0,c=c+Math.imul(_,gt)|0,e=e+Math.imul(_,vt)|0,e=e+Math.imul(S,gt)|0,u=u+Math.imul(S,vt)|0;var he=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(he>>>26)|0,he&=67108863,c=Math.imul(Q,et),e=Math.imul(Q,rt),e=e+Math.imul(Y,et)|0,u=Math.imul(Y,rt),c=c+Math.imul(V,nt)|0,e=e+Math.imul(V,it)|0,e=e+Math.imul(z,nt)|0,u=u+Math.imul(z,it)|0,c=c+Math.imul(G,st)|0,e=e+Math.imul(G,ot)|0,e=e+Math.imul(K,st)|0,u=u+Math.imul(K,ot)|0,c=c+Math.imul(Z,at)|0,e=e+Math.imul(Z,ht)|0,e=e+Math.imul(J,at)|0,u=u+Math.imul(J,ht)|0,c=c+Math.imul(H,ft)|0,e=e+Math.imul(H,ct)|0,e=e+Math.imul($,ft)|0,u=u+Math.imul($,ct)|0,c=c+Math.imul(j,ut)|0,e=e+Math.imul(j,lt)|0,e=e+Math.imul(D,ut)|0,u=u+Math.imul(D,lt)|0,c=c+Math.imul(q,dt)|0,e=e+Math.imul(q,pt)|0,e=e+Math.imul(L,dt)|0,u=u+Math.imul(L,pt)|0,c=c+Math.imul(C,gt)|0,e=e+Math.imul(C,vt)|0,e=e+Math.imul(N,gt)|0,u=u+Math.imul(N,vt)|0,c=c+Math.imul(_,mt)|0,e=e+Math.imul(_,yt)|0,e=e+Math.imul(S,mt)|0,u=u+Math.imul(S,yt)|0;var fe=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(fe>>>26)|0,fe&=67108863,c=Math.imul(X,et),e=Math.imul(X,rt),e=e+Math.imul(tt,et)|0,u=Math.imul(tt,rt),c=c+Math.imul(Q,nt)|0,e=e+Math.imul(Q,it)|0,e=e+Math.imul(Y,nt)|0,u=u+Math.imul(Y,it)|0,c=c+Math.imul(V,st)|0,e=e+Math.imul(V,ot)|0,e=e+Math.imul(z,st)|0,u=u+Math.imul(z,ot)|0,c=c+Math.imul(G,at)|0,e=e+Math.imul(G,ht)|0,e=e+Math.imul(K,at)|0,u=u+Math.imul(K,ht)|0,c=c+Math.imul(Z,ft)|0,e=e+Math.imul(Z,ct)|0,e=e+Math.imul(J,ft)|0,u=u+Math.imul(J,ct)|0,c=c+Math.imul(H,ut)|0,e=e+Math.imul(H,lt)|0,e=e+Math.imul($,ut)|0,u=u+Math.imul($,lt)|0,c=c+Math.imul(j,dt)|0,e=e+Math.imul(j,pt)|0,e=e+Math.imul(D,dt)|0,u=u+Math.imul(D,pt)|0,c=c+Math.imul(q,gt)|0,e=e+Math.imul(q,vt)|0,e=e+Math.imul(L,gt)|0,u=u+Math.imul(L,vt)|0,c=c+Math.imul(C,mt)|0,e=e+Math.imul(C,yt)|0,e=e+Math.imul(N,mt)|0,u=u+Math.imul(N,yt)|0,c=c+Math.imul(_,wt)|0,e=e+Math.imul(_,_t)|0,e=e+Math.imul(S,wt)|0,u=u+Math.imul(S,_t)|0;var ce=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ce>>>26)|0,ce&=67108863,c=Math.imul(X,nt),e=Math.imul(X,it),e=e+Math.imul(tt,nt)|0,u=Math.imul(tt,it),c=c+Math.imul(Q,st)|0,e=e+Math.imul(Q,ot)|0,e=e+Math.imul(Y,st)|0,u=u+Math.imul(Y,ot)|0,c=c+Math.imul(V,at)|0,e=e+Math.imul(V,ht)|0,e=e+Math.imul(z,at)|0,u=u+Math.imul(z,ht)|0,c=c+Math.imul(G,ft)|0,e=e+Math.imul(G,ct)|0,e=e+Math.imul(K,ft)|0,u=u+Math.imul(K,ct)|0,c=c+Math.imul(Z,ut)|0,e=e+Math.imul(Z,lt)|0,e=e+Math.imul(J,ut)|0,u=u+Math.imul(J,lt)|0,c=c+Math.imul(H,dt)|0,e=e+Math.imul(H,pt)|0,e=e+Math.imul($,dt)|0,u=u+Math.imul($,pt)|0,c=c+Math.imul(j,gt)|0,e=e+Math.imul(j,vt)|0,e=e+Math.imul(D,gt)|0,u=u+Math.imul(D,vt)|0,c=c+Math.imul(q,mt)|0,e=e+Math.imul(q,yt)|0,e=e+Math.imul(L,mt)|0,u=u+Math.imul(L,yt)|0,c=c+Math.imul(C,wt)|0,e=e+Math.imul(C,_t)|0,e=e+Math.imul(N,wt)|0,u=u+Math.imul(N,_t)|0;var ue=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ue>>>26)|0,ue&=67108863,c=Math.imul(X,st),e=Math.imul(X,ot),e=e+Math.imul(tt,st)|0,u=Math.imul(tt,ot),c=c+Math.imul(Q,at)|0,e=e+Math.imul(Q,ht)|0,e=e+Math.imul(Y,at)|0,u=u+Math.imul(Y,ht)|0,c=c+Math.imul(V,ft)|0,e=e+Math.imul(V,ct)|0,e=e+Math.imul(z,ft)|0,u=u+Math.imul(z,ct)|0,c=c+Math.imul(G,ut)|0,e=e+Math.imul(G,lt)|0,e=e+Math.imul(K,ut)|0,u=u+Math.imul(K,lt)|0,c=c+Math.imul(Z,dt)|0,e=e+Math.imul(Z,pt)|0,e=e+Math.imul(J,dt)|0,u=u+Math.imul(J,pt)|0,c=c+Math.imul(H,gt)|0,e=e+Math.imul(H,vt)|0,e=e+Math.imul($,gt)|0,u=u+Math.imul($,vt)|0,c=c+Math.imul(j,mt)|0,e=e+Math.imul(j,yt)|0,e=e+Math.imul(D,mt)|0,u=u+Math.imul(D,yt)|0,c=c+Math.imul(q,wt)|0,e=e+Math.imul(q,_t)|0,e=e+Math.imul(L,wt)|0,u=u+Math.imul(L,_t)|0;var le=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(le>>>26)|0,le&=67108863,c=Math.imul(X,at),e=Math.imul(X,ht),e=e+Math.imul(tt,at)|0,u=Math.imul(tt,ht),c=c+Math.imul(Q,ft)|0,e=e+Math.imul(Q,ct)|0,e=e+Math.imul(Y,ft)|0,u=u+Math.imul(Y,ct)|0,c=c+Math.imul(V,ut)|0,e=e+Math.imul(V,lt)|0,e=e+Math.imul(z,ut)|0,u=u+Math.imul(z,lt)|0,c=c+Math.imul(G,dt)|0,e=e+Math.imul(G,pt)|0,e=e+Math.imul(K,dt)|0,u=u+Math.imul(K,pt)|0,c=c+Math.imul(Z,gt)|0,e=e+Math.imul(Z,vt)|0,e=e+Math.imul(J,gt)|0,u=u+Math.imul(J,vt)|0,c=c+Math.imul(H,mt)|0,e=e+Math.imul(H,yt)|0,e=e+Math.imul($,mt)|0,u=u+Math.imul($,yt)|0,c=c+Math.imul(j,wt)|0,e=e+Math.imul(j,_t)|0,e=e+Math.imul(D,wt)|0,u=u+Math.imul(D,_t)|0;var de=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(de>>>26)|0,de&=67108863,c=Math.imul(X,ft),e=Math.imul(X,ct),e=e+Math.imul(tt,ft)|0,u=Math.imul(tt,ct),c=c+Math.imul(Q,ut)|0,e=e+Math.imul(Q,lt)|0,e=e+Math.imul(Y,ut)|0,u=u+Math.imul(Y,lt)|0,c=c+Math.imul(V,dt)|0,e=e+Math.imul(V,pt)|0,e=e+Math.imul(z,dt)|0,u=u+Math.imul(z,pt)|0,c=c+Math.imul(G,gt)|0,e=e+Math.imul(G,vt)|0,e=e+Math.imul(K,gt)|0,u=u+Math.imul(K,vt)|0,c=c+Math.imul(Z,mt)|0,e=e+Math.imul(Z,yt)|0,e=e+Math.imul(J,mt)|0,u=u+Math.imul(J,yt)|0,c=c+Math.imul(H,wt)|0,e=e+Math.imul(H,_t)|0,e=e+Math.imul($,wt)|0,u=u+Math.imul($,_t)|0;var pe=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(pe>>>26)|0,pe&=67108863,c=Math.imul(X,ut),e=Math.imul(X,lt),e=e+Math.imul(tt,ut)|0,u=Math.imul(tt,lt),c=c+Math.imul(Q,dt)|0,e=e+Math.imul(Q,pt)|0,e=e+Math.imul(Y,dt)|0,u=u+Math.imul(Y,pt)|0,c=c+Math.imul(V,gt)|0,e=e+Math.imul(V,vt)|0,e=e+Math.imul(z,gt)|0,u=u+Math.imul(z,vt)|0,c=c+Math.imul(G,mt)|0,e=e+Math.imul(G,yt)|0,e=e+Math.imul(K,mt)|0,u=u+Math.imul(K,yt)|0,c=c+Math.imul(Z,wt)|0,e=e+Math.imul(Z,_t)|0,e=e+Math.imul(J,wt)|0,u=u+Math.imul(J,_t)|0;var ge=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ge>>>26)|0,ge&=67108863,c=Math.imul(X,dt),e=Math.imul(X,pt),e=e+Math.imul(tt,dt)|0,u=Math.imul(tt,pt),c=c+Math.imul(Q,gt)|0,e=e+Math.imul(Q,vt)|0,e=e+Math.imul(Y,gt)|0,u=u+Math.imul(Y,vt)|0,c=c+Math.imul(V,mt)|0,e=e+Math.imul(V,yt)|0,e=e+Math.imul(z,mt)|0,u=u+Math.imul(z,yt)|0,c=c+Math.imul(G,wt)|0,e=e+Math.imul(G,_t)|0,e=e+Math.imul(K,wt)|0,u=u+Math.imul(K,_t)|0;var ve=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ve>>>26)|0,ve&=67108863,c=Math.imul(X,gt),e=Math.imul(X,vt),e=e+Math.imul(tt,gt)|0,u=Math.imul(tt,vt),c=c+Math.imul(Q,mt)|0,e=e+Math.imul(Q,yt)|0,e=e+Math.imul(Y,mt)|0,u=u+Math.imul(Y,yt)|0,c=c+Math.imul(V,wt)|0,e=e+Math.imul(V,_t)|0,e=e+Math.imul(z,wt)|0,u=u+Math.imul(z,_t)|0;var me=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(me>>>26)|0,me&=67108863,c=Math.imul(X,mt),e=Math.imul(X,yt),e=e+Math.imul(tt,mt)|0,u=Math.imul(tt,yt),c=c+Math.imul(Q,wt)|0,e=e+Math.imul(Q,_t)|0,e=e+Math.imul(Y,wt)|0,u=u+Math.imul(Y,_t)|0;var ye=(g+c|0)+((e&8191)<<13)|0;g=(u+(e>>>13)|0)+(ye>>>26)|0,ye&=67108863,c=Math.imul(X,wt),e=Math.imul(X,_t),e=e+Math.imul(tt,wt)|0,u=Math.imul(tt,_t);var we=(g+c|0)+((e&8191)<<13)|0;return g=(u+(e>>>13)|0)+(we>>>26)|0,we&=67108863,p[0]=ee,p[1]=re,p[2]=ne,p[3]=ie,p[4]=se,p[5]=oe,p[6]=ae,p[7]=he,p[8]=fe,p[9]=ce,p[10]=ue,p[11]=le,p[12]=de,p[13]=pe,p[14]=ge,p[15]=ve,p[16]=me,p[17]=ye,p[18]=we,g!==0&&(p[19]=g,s.length++),s};Math.imul||(Mt=W);function Rt(h,t,n){n.negative=t.negative^h.negative,n.length=h.length+t.length;for(var s=0,o=0,f=0;f<n.length-1;f++){var p=o;o=0;for(var g=s&67108863,c=Math.min(f,t.length-1),e=Math.max(0,f-h.length+1);e<=c;e++){var u=f-e,M=h.words[u]|0,_=t.words[e]|0,S=M*_,O=S&67108863;p=p+(S/67108864|0)|0,O=O+g|0,g=O&67108863,p=p+(O>>>26)|0,o+=p>>>26,p&=67108863}n.words[f]=g,s=p,p=o}return s!==0?n.words[f]=s:n.length--,n.strip()}function m(h,t,n){var s=new y;return s.mulp(h,t,n)}l.prototype.mulTo=function(t,n){var s,o=this.length+t.length;return this.length===10&&t.length===10?s=Mt(this,t,n):o<63?s=W(this,t,n):o<1024?s=Rt(this,t,n):s=m(this,t,n),s};function y(h,t){this.x=h,this.y=t}y.prototype.makeRBT=function(t){for(var n=new Array(t),s=l.prototype._countBits(t)-1,o=0;o<t;o++)n[o]=this.revBin(o,s,t);return n},y.prototype.revBin=function(t,n,s){if(t===0||t===s-1)return t;for(var o=0,f=0;f<n;f++)o|=(t&1)<<n-f-1,t>>=1;return o},y.prototype.permute=function(t,n,s,o,f,p){for(var g=0;g<p;g++)o[g]=n[t[g]],f[g]=s[t[g]]},y.prototype.transform=function(t,n,s,o,f,p){this.permute(p,t,n,s,o,f);for(var g=1;g<f;g<<=1)for(var c=g<<1,e=Math.cos(2*Math.PI/c),u=Math.sin(2*Math.PI/c),M=0;M<f;M+=c)for(var _=e,S=u,O=0;O<g;O++){var C=s[M+O],N=o[M+O],Nt=s[M+O+g],q=o[M+O+g],L=_*Nt-S*q;q=_*q+S*Nt,Nt=L,s[M+O]=C+Nt,o[M+O]=N+q,s[M+O+g]=C-Nt,o[M+O+g]=N-q,O!==c&&(L=e*_-u*S,S=e*S+u*_,_=L)}},y.prototype.guessLen13b=function(t,n){var s=Math.max(n,t)|1,o=s&1,f=0;for(s=s/2|0;s;s=s>>>1)f++;return 1<<f+1+o},y.prototype.conjugate=function(t,n,s){if(!(s<=1))for(var o=0;o<s/2;o++){var f=t[o];t[o]=t[s-o-1],t[s-o-1]=f,f=n[o],n[o]=-n[s-o-1],n[s-o-1]=-f}},y.prototype.normalize13b=function(t,n){for(var s=0,o=0;o<n/2;o++){var f=Math.round(t[2*o+1]/n)*8192+Math.round(t[2*o]/n)+s;t[o]=f&67108863,f<67108864?s=0:s=f/67108864|0}return t},y.prototype.convert13b=function(t,n,s,o){for(var f=0,p=0;p<n;p++)f=f+(t[p]|0),s[2*p]=f&8191,f=f>>>13,s[2*p+1]=f&8191,f=f>>>13;for(p=2*n;p<o;++p)s[p]=0;d(f===0),d((f&-8192)===0)},y.prototype.stub=function(t){for(var n=new Array(t),s=0;s<t;s++)n[s]=0;return n},y.prototype.mulp=function(t,n,s){var o=2*this.guessLen13b(t.length,n.length),f=this.makeRBT(o),p=this.stub(o),g=new Array(o),c=new Array(o),e=new Array(o),u=new Array(o),M=new Array(o),_=new Array(o),S=s.words;S.length=o,this.convert13b(t.words,t.length,g,o),this.convert13b(n.words,n.length,u,o),this.transform(g,p,c,e,o,f),this.transform(u,p,M,_,o,f);for(var O=0;O<o;O++){var C=c[O]*M[O]-e[O]*_[O];e[O]=c[O]*_[O]+e[O]*M[O],c[O]=C}return this.conjugate(c,e,o),this.transform(c,e,S,p,o,f),this.conjugate(S,p,o),this.normalize13b(S,o),s.negative=t.negative^n.negative,s.length=t.length+n.length,s.strip()},l.prototype.mul=function(t){var n=new l(null);return n.words=new Array(this.length+t.length),this.mulTo(t,n)},l.prototype.mulf=function(t){var n=new l(null);return n.words=new Array(this.length+t.length),m(this,t,n)},l.prototype.imul=function(t){return this.clone().mulTo(t,this)},l.prototype.imuln=function(t){d(typeof t=="number"),d(t<67108864);for(var n=0,s=0;s<this.length;s++){var o=(this.words[s]|0)*t,f=(o&67108863)+(n&67108863);n>>=26,n+=o/67108864|0,n+=f>>>26,this.words[s]=f&67108863}return n!==0&&(this.words[s]=n,this.length++),this},l.prototype.muln=function(t){return this.clone().imuln(t)},l.prototype.sqr=function(){return this.mul(this)},l.prototype.isqr=function(){return this.imul(this.clone())},l.prototype.pow=function(t){var n=F(t);if(n.length===0)return new l(1);for(var s=this,o=0;o<n.length&&n[o]===0;o++,s=s.sqr());if(++o<n.length)for(var f=s.sqr();o<n.length;o++,f=f.sqr())n[o]!==0&&(s=s.mul(f));return s},l.prototype.iushln=function(t){d(typeof t=="number"&&t>=0);var n=t%26,s=(t-n)/26,o=67108863>>>26-n<<26-n,f;if(n!==0){var p=0;for(f=0;f<this.length;f++){var g=this.words[f]&o,c=(this.words[f]|0)-g<<n;this.words[f]=c|p,p=g>>>26-n}p&&(this.words[f]=p,this.length++)}if(s!==0){for(f=this.length-1;f>=0;f--)this.words[f+s]=this.words[f];for(f=0;f<s;f++)this.words[f]=0;this.length+=s}return this.strip()},l.prototype.ishln=function(t){return d(this.negative===0),this.iushln(t)},l.prototype.iushrn=function(t,n,s){d(typeof t=="number"&&t>=0);var o;n?o=(n-n%26)/26:o=0;var f=t%26,p=Math.min((t-f)/26,this.length),g=67108863^67108863>>>f<<f,c=s;if(o-=p,o=Math.max(0,o),c){for(var e=0;e<p;e++)c.words[e]=this.words[e];c.length=p}if(p!==0)if(this.length>p)for(this.length-=p,e=0;e<this.length;e++)this.words[e]=this.words[e+p];else this.words[0]=0,this.length=1;var u=0;for(e=this.length-1;e>=0&&(u!==0||e>=o);e--){var M=this.words[e]|0;this.words[e]=u<<26-f|M>>>f,u=M&g}return c&&u!==0&&(c.words[c.length++]=u),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},l.prototype.ishrn=function(t,n,s){return d(this.negative===0),this.iushrn(t,n,s)},l.prototype.shln=function(t){return this.clone().ishln(t)},l.prototype.ushln=function(t){return this.clone().iushln(t)},l.prototype.shrn=function(t){return this.clone().ishrn(t)},l.prototype.ushrn=function(t){return this.clone().iushrn(t)},l.prototype.testn=function(t){d(typeof t=="number"&&t>=0);var n=t%26,s=(t-n)/26,o=1<<n;if(this.length<=s)return!1;var f=this.words[s];return!!(f&o)},l.prototype.imaskn=function(t){d(typeof t=="number"&&t>=0);var n=t%26,s=(t-n)/26;if(d(this.negative===0,"imaskn works only with positive numbers"),this.length<=s)return this;if(n!==0&&s++,this.length=Math.min(s,this.length),n!==0){var o=67108863^67108863>>>n<<n;this.words[this.length-1]&=o}return this.strip()},l.prototype.maskn=function(t){return this.clone().imaskn(t)},l.prototype.iaddn=function(t){return d(typeof t=="number"),d(t<67108864),t<0?this.isubn(-t):this.negative!==0?this.length===1&&(this.words[0]|0)<t?(this.words[0]=t-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},l.prototype._iaddn=function(t){this.words[0]+=t;for(var n=0;n<this.length&&this.words[n]>=67108864;n++)this.words[n]-=67108864,n===this.length-1?this.words[n+1]=1:this.words[n+1]++;return this.length=Math.max(this.length,n+1),this},l.prototype.isubn=function(t){if(d(typeof t=="number"),d(t<67108864),t<0)return this.iaddn(-t);if(this.negative!==0)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var n=0;n<this.length&&this.words[n]<0;n++)this.words[n]+=67108864,this.words[n+1]-=1;return this.strip()},l.prototype.addn=function(t){return this.clone().iaddn(t)},l.prototype.subn=function(t){return this.clone().isubn(t)},l.prototype.iabs=function(){return this.negative=0,this},l.prototype.abs=function(){return this.clone().iabs()},l.prototype._ishlnsubmul=function(t,n,s){var o=t.length+s,f;this._expand(o);var p,g=0;for(f=0;f<t.length;f++){p=(this.words[f+s]|0)+g;var c=(t.words[f]|0)*n;p-=c&67108863,g=(p>>26)-(c/67108864|0),this.words[f+s]=p&67108863}for(;f<this.length-s;f++)p=(this.words[f+s]|0)+g,g=p>>26,this.words[f+s]=p&67108863;if(g===0)return this.strip();for(d(g===-1),g=0,f=0;f<this.length;f++)p=-(this.words[f]|0)+g,g=p>>26,this.words[f]=p&67108863;return this.negative=1,this.strip()},l.prototype._wordDiv=function(t,n){var s=this.length-t.length,o=this.clone(),f=t,p=f.words[f.length-1]|0,g=this._countBits(p);s=26-g,s!==0&&(f=f.ushln(s),o.iushln(s),p=f.words[f.length-1]|0);var c=o.length-f.length,e;if(n!=="mod"){e=new l(null),e.length=c+1,e.words=new Array(e.length);for(var u=0;u<e.length;u++)e.words[u]=0}var M=o.clone()._ishlnsubmul(f,1,c);M.negative===0&&(o=M,e&&(e.words[c]=1));for(var _=c-1;_>=0;_--){var S=(o.words[f.length+_]|0)*67108864+(o.words[f.length+_-1]|0);for(S=Math.min(S/p|0,67108863),o._ishlnsubmul(f,S,_);o.negative!==0;)S--,o.negative=0,o._ishlnsubmul(f,1,_),o.isZero()||(o.negative^=1);e&&(e.words[_]=S)}return e&&e.strip(),o.strip(),n!=="div"&&s!==0&&o.iushrn(s),{div:e||null,mod:o}},l.prototype.divmod=function(t,n,s){if(d(!t.isZero()),this.isZero())return{div:new l(0),mod:new l(0)};var o,f,p;return this.negative!==0&&t.negative===0?(p=this.neg().divmod(t,n),n!=="mod"&&(o=p.div.neg()),n!=="div"&&(f=p.mod.neg(),s&&f.negative!==0&&f.iadd(t)),{div:o,mod:f}):this.negative===0&&t.negative!==0?(p=this.divmod(t.neg(),n),n!=="mod"&&(o=p.div.neg()),{div:o,mod:p.mod}):this.negative&t.negative?(p=this.neg().divmod(t.neg(),n),n!=="div"&&(f=p.mod.neg(),s&&f.negative!==0&&f.isub(t)),{div:p.div,mod:f}):t.length>this.length||this.cmp(t)<0?{div:new l(0),mod:this}:t.length===1?n==="div"?{div:this.divn(t.words[0]),mod:null}:n==="mod"?{div:null,mod:new l(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new l(this.modn(t.words[0]))}:this._wordDiv(t,n)},l.prototype.div=function(t){return this.divmod(t,"div",!1).div},l.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},l.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},l.prototype.divRound=function(t){var n=this.divmod(t);if(n.mod.isZero())return n.div;var s=n.div.negative!==0?n.mod.isub(t):n.mod,o=t.ushrn(1),f=t.andln(1),p=s.cmp(o);return p<0||f===1&&p===0?n.div:n.div.negative!==0?n.div.isubn(1):n.div.iaddn(1)},l.prototype.modn=function(t){d(t<=67108863);for(var n=(1<<26)%t,s=0,o=this.length-1;o>=0;o--)s=(n*s+(this.words[o]|0))%t;return s},l.prototype.idivn=function(t){d(t<=67108863);for(var n=0,s=this.length-1;s>=0;s--){var o=(this.words[s]|0)+n*67108864;this.words[s]=o/t|0,n=o%t}return this.strip()},l.prototype.divn=function(t){return this.clone().idivn(t)},l.prototype.egcd=function(t){d(t.negative===0),d(!t.isZero());var n=this,s=t.clone();n.negative!==0?n=n.umod(t):n=n.clone();for(var o=new l(1),f=new l(0),p=new l(0),g=new l(1),c=0;n.isEven()&&s.isEven();)n.iushrn(1),s.iushrn(1),++c;for(var e=s.clone(),u=n.clone();!n.isZero();){for(var M=0,_=1;!(n.words[0]&_)&&M<26;++M,_<<=1);if(M>0)for(n.iushrn(M);M-- >0;)(o.isOdd()||f.isOdd())&&(o.iadd(e),f.isub(u)),o.iushrn(1),f.iushrn(1);for(var S=0,O=1;!(s.words[0]&O)&&S<26;++S,O<<=1);if(S>0)for(s.iushrn(S);S-- >0;)(p.isOdd()||g.isOdd())&&(p.iadd(e),g.isub(u)),p.iushrn(1),g.iushrn(1);n.cmp(s)>=0?(n.isub(s),o.isub(p),f.isub(g)):(s.isub(n),p.isub(o),g.isub(f))}return{a:p,b:g,gcd:s.iushln(c)}},l.prototype._invmp=function(t){d(t.negative===0),d(!t.isZero());var n=this,s=t.clone();n.negative!==0?n=n.umod(t):n=n.clone();for(var o=new l(1),f=new l(0),p=s.clone();n.cmpn(1)>0&&s.cmpn(1)>0;){for(var g=0,c=1;!(n.words[0]&c)&&g<26;++g,c<<=1);if(g>0)for(n.iushrn(g);g-- >0;)o.isOdd()&&o.iadd(p),o.iushrn(1);for(var e=0,u=1;!(s.words[0]&u)&&e<26;++e,u<<=1);if(e>0)for(s.iushrn(e);e-- >0;)f.isOdd()&&f.iadd(p),f.iushrn(1);n.cmp(s)>=0?(n.isub(s),o.isub(f)):(s.isub(n),f.isub(o))}var M;return n.cmpn(1)===0?M=o:M=f,M.cmpn(0)<0&&M.iadd(t),M},l.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var n=this.clone(),s=t.clone();n.negative=0,s.negative=0;for(var o=0;n.isEven()&&s.isEven();o++)n.iushrn(1),s.iushrn(1);do{for(;n.isEven();)n.iushrn(1);for(;s.isEven();)s.iushrn(1);var f=n.cmp(s);if(f<0){var p=n;n=s,s=p}else if(f===0||s.cmpn(1)===0)break;n.isub(s)}while(!0);return s.iushln(o)},l.prototype.invm=function(t){return this.egcd(t).a.umod(t)},l.prototype.isEven=function(){return(this.words[0]&1)===0},l.prototype.isOdd=function(){return(this.words[0]&1)===1},l.prototype.andln=function(t){return this.words[0]&t},l.prototype.bincn=function(t){d(typeof t=="number");var n=t%26,s=(t-n)/26,o=1<<n;if(this.length<=s)return this._expand(s+1),this.words[s]|=o,this;for(var f=o,p=s;f!==0&&p<this.length;p++){var g=this.words[p]|0;g+=f,f=g>>>26,g&=67108863,this.words[p]=g}return f!==0&&(this.words[p]=f,this.length++),this},l.prototype.isZero=function(){return this.length===1&&this.words[0]===0},l.prototype.cmpn=function(t){var n=t<0;if(this.negative!==0&&!n)return-1;if(this.negative===0&&n)return 1;this.strip();var s;if(this.length>1)s=1;else{n&&(t=-t),d(t<=67108863,"Number is too big");var o=this.words[0]|0;s=o===t?0:o<t?-1:1}return this.negative!==0?-s|0:s},l.prototype.cmp=function(t){if(this.negative!==0&&t.negative===0)return-1;if(this.negative===0&&t.negative!==0)return 1;var n=this.ucmp(t);return this.negative!==0?-n|0:n},l.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var n=0,s=this.length-1;s>=0;s--){var o=this.words[s]|0,f=t.words[s]|0;if(o!==f){o<f?n=-1:o>f&&(n=1);break}}return n},l.prototype.gtn=function(t){return this.cmpn(t)===1},l.prototype.gt=function(t){return this.cmp(t)===1},l.prototype.gten=function(t){return this.cmpn(t)>=0},l.prototype.gte=function(t){return this.cmp(t)>=0},l.prototype.ltn=function(t){return this.cmpn(t)===-1},l.prototype.lt=function(t){return this.cmp(t)===-1},l.prototype.lten=function(t){return this.cmpn(t)<=0},l.prototype.lte=function(t){return this.cmp(t)<=0},l.prototype.eqn=function(t){return this.cmpn(t)===0},l.prototype.eq=function(t){return this.cmp(t)===0},l.red=function(t){return new E(t)},l.prototype.toRed=function(t){return d(!this.red,"Already a number in reduction context"),d(this.negative===0,"red works only with positives"),t.convertTo(this)._forceRed(t)},l.prototype.fromRed=function(){return d(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},l.prototype._forceRed=function(t){return this.red=t,this},l.prototype.forceRed=function(t){return d(!this.red,"Already a number in reduction context"),this._forceRed(t)},l.prototype.redAdd=function(t){return d(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},l.prototype.redIAdd=function(t){return d(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},l.prototype.redSub=function(t){return d(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},l.prototype.redISub=function(t){return d(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},l.prototype.redShl=function(t){return d(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},l.prototype.redMul=function(t){return d(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},l.prototype.redIMul=function(t){return d(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},l.prototype.redSqr=function(){return d(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},l.prototype.redISqr=function(){return d(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},l.prototype.redSqrt=function(){return d(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},l.prototype.redInvm=function(){return d(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},l.prototype.redNeg=function(){return d(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},l.prototype.redPow=function(t){return d(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function w(h,t){this.name=h,this.p=new l(t,16),this.n=this.p.bitLength(),this.k=new l(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}w.prototype._tmp=function(){var t=new l(null);return t.words=new Array(Math.ceil(this.n/13)),t},w.prototype.ireduce=function(t){var n=t,s;do this.split(n,this.tmp),n=this.imulK(n),n=n.iadd(this.tmp),s=n.bitLength();while(s>this.n);var o=s<this.n?-1:n.ucmp(this.p);return o===0?(n.words[0]=0,n.length=1):o>0?n.isub(this.p):n.strip(),n},w.prototype.split=function(t,n){t.iushrn(this.n,0,n)},w.prototype.imulK=function(t){return t.imul(this.k)};function x(){w.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}v(x,w),x.prototype.split=function(t,n){for(var s=4194303,o=Math.min(t.length,9),f=0;f<o;f++)n.words[f]=t.words[f];if(n.length=o,t.length<=9){t.words[0]=0,t.length=1;return}var p=t.words[9];for(n.words[n.length++]=p&s,f=10;f<t.length;f++){var g=t.words[f]|0;t.words[f-10]=(g&s)<<4|p>>>22,p=g}p>>>=22,t.words[f-10]=p,p===0&&t.length>10?t.length-=10:t.length-=9},x.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var n=0,s=0;s<t.length;s++){var o=t.words[s]|0;n+=o*977,t.words[s]=n&67108863,n=o*64+(n/67108864|0)}return t.words[t.length-1]===0&&(t.length--,t.words[t.length-1]===0&&t.length--),t};function B(){w.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}v(B,w);function k(){w.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}v(k,w);function St(){w.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}v(St,w),St.prototype.imulK=function(t){for(var n=0,s=0;s<t.length;s++){var o=(t.words[s]|0)*19+n,f=o&67108863;o>>>=26,t.words[s]=f,n=o}return n!==0&&(t.words[t.length++]=n),t},l._prime=function(t){if(b[t])return b[t];var n;if(t==="k256")n=new x;else if(t==="p224")n=new B;else if(t==="p192")n=new k;else if(t==="p25519")n=new St;else throw new Error("Unknown prime "+t);return b[t]=n,n};function E(h){if(typeof h=="string"){var t=l._prime(h);this.m=t.p,this.prime=t}else d(h.gtn(1),"modulus must be greater than 1"),this.m=h,this.prime=null}E.prototype._verify1=function(t){d(t.negative===0,"red works only with positives"),d(t.red,"red works only with red numbers")},E.prototype._verify2=function(t,n){d((t.negative|n.negative)===0,"red works only with positives"),d(t.red&&t.red===n.red,"red works only with red numbers")},E.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},E.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},E.prototype.add=function(t,n){this._verify2(t,n);var s=t.add(n);return s.cmp(this.m)>=0&&s.isub(this.m),s._forceRed(this)},E.prototype.iadd=function(t,n){this._verify2(t,n);var s=t.iadd(n);return s.cmp(this.m)>=0&&s.isub(this.m),s},E.prototype.sub=function(t,n){this._verify2(t,n);var s=t.sub(n);return s.cmpn(0)<0&&s.iadd(this.m),s._forceRed(this)},E.prototype.isub=function(t,n){this._verify2(t,n);var s=t.isub(n);return s.cmpn(0)<0&&s.iadd(this.m),s},E.prototype.shl=function(t,n){return this._verify1(t),this.imod(t.ushln(n))},E.prototype.imul=function(t,n){return this._verify2(t,n),this.imod(t.imul(n))},E.prototype.mul=function(t,n){return this._verify2(t,n),this.imod(t.mul(n))},E.prototype.isqr=function(t){return this.imul(t,t.clone())},E.prototype.sqr=function(t){return this.mul(t,t)},E.prototype.sqrt=function(t){if(t.isZero())return t.clone();var n=this.m.andln(3);if(d(n%2===1),n===3){var s=this.m.add(new l(1)).iushrn(2);return this.pow(t,s)}for(var o=this.m.subn(1),f=0;!o.isZero()&&o.andln(1)===0;)f++,o.iushrn(1);d(!o.isZero());var p=new l(1).toRed(this),g=p.redNeg(),c=this.m.subn(1).iushrn(1),e=this.m.bitLength();for(e=new l(2*e*e).toRed(this);this.pow(e,c).cmp(g)!==0;)e.redIAdd(g);for(var u=this.pow(e,o),M=this.pow(t,o.addn(1).iushrn(1)),_=this.pow(t,o),S=f;_.cmp(p)!==0;){for(var O=_,C=0;O.cmp(p)!==0;C++)O=O.redSqr();d(C<S);var N=this.pow(u,new l(1).iushln(S-C-1));M=M.redMul(N),u=N.redSqr(),_=_.redMul(u),S=C}return M},E.prototype.invm=function(t){var n=t._invmp(this.m);return n.negative!==0?(n.negative=0,this.imod(n).redNeg()):this.imod(n)},E.prototype.pow=function(t,n){if(n.isZero())return new l(1).toRed(this);if(n.cmpn(1)===0)return t.clone();var s=4,o=new Array(1<<s);o[0]=new l(1).toRed(this),o[1]=t;for(var f=2;f<o.length;f++)o[f]=this.mul(o[f-1],t);var p=o[0],g=0,c=0,e=n.bitLength()%26;for(e===0&&(e=26),f=n.length-1;f>=0;f--){for(var u=n.words[f],M=e-1;M>=0;M--){var _=u>>M&1;if(p!==o[0]&&(p=this.sqr(p)),_===0&&g===0){c=0;continue}g<<=1,g|=_,c++,!(c!==s&&(f!==0||M!==0))&&(p=this.mul(p,o[g]),c=0,g=0)}e=26}return p},E.prototype.convertTo=function(t){var n=t.umod(this.m);return n===t?n.clone():n},E.prototype.convertFrom=function(t){var n=t.clone();return n.red=null,n},l.mont=function(t){return new Et(t)};function Et(h){E.call(this,h),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new l(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v(Et,E),Et.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},Et.prototype.convertFrom=function(t){var n=this.imod(t.mul(this.rinv));return n.red=null,n},Et.prototype.imul=function(t,n){if(t.isZero()||n.isZero())return t.words[0]=0,t.length=1,t;var s=t.imul(n),o=s.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),f=s.isub(o).iushrn(this.shift),p=f;return f.cmp(this.m)>=0?p=f.isub(this.m):f.cmpn(0)<0&&(p=f.iadd(this.m)),p._forceRed(this)},Et.prototype.mul=function(t,n){if(t.isZero()||n.isZero())return new l(0)._forceRed(this);var s=t.mul(n),o=s.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),f=s.isub(o).iushrn(this.shift),p=f;return f.cmp(this.m)>=0?p=f.isub(this.m):f.cmpn(0)<0&&(p=f.iadd(this.m)),p._forceRed(this)},Et.prototype.invm=function(t){var n=this.imod(t._invmp(this.m).mul(this.r2));return n._forceRed(this)}})(i,At)})(Nn);const qn=Se;var Pn=Ae;Ae.strict=Rr;Ae.loose=Er;var Bn=Object.prototype.toString,Ln={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function Ae(i){return Rr(i)||Er(i)}function Rr(i){return i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array||i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Uint16Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array}function Er(i){return Ln[Bn.call(i)]}var Wn=Pn.strict,Un=function(r){if(Wn(r)){var a=zt.from(r.buffer);return r.byteLength!==r.buffer.byteLength&&(a=a.slice(r.byteOffset,r.byteOffset+r.byteLength)),a}else return zt.from(r)};const Ir="hex",Or="utf8",Xt="0";function Dt(i){return new Uint8Array(i)}function xr(i,r=!1){const a=i.toString(Ir);return r?$t(a):a}function Fn(i){return i.toString(Or)}function te(i){return Un(i)}function Ft(i,r=!1){return xr(te(i),r)}function jn(i){return Fn(te(i))}function Dn(i){return zt.from(Pt(i),Ir)}function jt(i){return Dt(Dn(i))}function Ne(i){return zt.from(i,Or)}function Hn(i){return Dt(Ne(i))}function $n(i,r=!1){return xr(Ne(i),r)}function Zn(i,r){return!(typeof i!="string"||!i.match(/^0x[0-9A-Fa-f]*$/)||r&&i.length!==2+2*r)}function kr(...i){let r=[];return i.forEach(a=>r=r.concat(Array.from(a))),new Uint8Array([...r])}function Jn(i,r=8){const a=i%r;return a?(i-a)/r*r+r:i}function Gn(i,r=8,a=Xt){return Kn(i,Jn(i.length,r),a)}function Kn(i,r,a=Xt){return zn(i,r,!0,a)}function Pt(i){return i.replace(/^0x/,"")}function $t(i){return i.startsWith("0x")?i:`0x${i}`}function Tr(i){return i=Pt(i),i=Gn(i,2),i&&(i=$t(i)),i}function Vn(i){const r=i.startsWith("0x");return i=Pt(i),i=i.startsWith(Xt)?i.substring(1):i,r?$t(i):i}function zn(i,r,a,d=Xt){const v=r-i.length;let l=i;if(v>0){const R=d.repeat(v);l=a?R+i:i+R}return l}function Re(i){return te(new Uint8Array(i))}function Qn(i,r){return Ft(new Uint8Array(i),!r)}function Yn(i){return Dt(i).buffer}function Xn(i){return Ne(i)}function ti(i,r){return $n(i,!r)}function ei(i){return jt(i).buffer}function Cr(i,r){const a=Pt(Tr(new qn(i).toString(16)));return r?a:$t(a)}var Zt={},Ee={},ri={get exports(){return Ee},set exports(i){Ee=i}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(i){var r,a,d,v,l,R,T,I,U,bt,A,F,W,Mt,Rt,m,y,b,w,x,B,k,St;(function(E){var Et=typeof At=="object"?At:typeof self=="object"?self:typeof this=="object"?this:{};E(h(Et,h(i.exports)));function h(t,n){return t!==Et&&(typeof Object.create=="function"?Object.defineProperty(t,"__esModule",{value:!0}):t.__esModule=!0),function(s,o){return t[s]=n?n(s,o):o}}})(function(E){var Et=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,t){h.__proto__=t}||function(h,t){for(var n in t)t.hasOwnProperty(n)&&(h[n]=t[n])};r=function(h,t){Et(h,t);function n(){this.constructor=h}h.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)},a=Object.assign||function(h){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(h[o]=t[o])}return h},d=function(h,t){var n={};for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&t.indexOf(s)<0&&(n[s]=h[s]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(h);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(h,s[o])&&(n[s[o]]=h[s[o]]);return n},v=function(h,t,n,s){var o=arguments.length,f=o<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,n):s,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(h,t,n,s);else for(var g=h.length-1;g>=0;g--)(p=h[g])&&(f=(o<3?p(f):o>3?p(t,n,f):p(t,n))||f);return o>3&&f&&Object.defineProperty(t,n,f),f},l=function(h,t){return function(n,s){t(n,s,h)}},R=function(h,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(h,t)},T=function(h,t,n,s){function o(f){return f instanceof n?f:new n(function(p){p(f)})}return new(n||(n=Promise))(function(f,p){function g(u){try{e(s.next(u))}catch(M){p(M)}}function c(u){try{e(s.throw(u))}catch(M){p(M)}}function e(u){u.done?f(u.value):o(u.value).then(g,c)}e((s=s.apply(h,t||[])).next())})},I=function(h,t){var n={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},s,o,f,p;return p={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function g(e){return function(u){return c([e,u])}}function c(e){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,o&&(f=e[0]&2?o.return:e[0]?o.throw||((f=o.return)&&f.call(o),0):o.next)&&!(f=f.call(o,e[1])).done)return f;switch(o=0,f&&(e=[e[0]&2,f.value]),e[0]){case 0:case 1:f=e;break;case 4:return n.label++,{value:e[1],done:!1};case 5:n.label++,o=e[1],e=[0];continue;case 7:e=n.ops.pop(),n.trys.pop();continue;default:if(f=n.trys,!(f=f.length>0&&f[f.length-1])&&(e[0]===6||e[0]===2)){n=0;continue}if(e[0]===3&&(!f||e[1]>f[0]&&e[1]<f[3])){n.label=e[1];break}if(e[0]===6&&n.label<f[1]){n.label=f[1],f=e;break}if(f&&n.label<f[2]){n.label=f[2],n.ops.push(e);break}f[2]&&n.ops.pop(),n.trys.pop();continue}e=t.call(h,n)}catch(u){e=[6,u],o=0}finally{s=f=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}},St=function(h,t,n,s){s===void 0&&(s=n),h[s]=t[n]},U=function(h,t){for(var n in h)n!=="default"&&!t.hasOwnProperty(n)&&(t[n]=h[n])},bt=function(h){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&h[t],s=0;if(n)return n.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&s>=h.length&&(h=void 0),{value:h&&h[s++],done:!h}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(h,t){var n=typeof Symbol=="function"&&h[Symbol.iterator];if(!n)return h;var s=n.call(h),o,f=[],p;try{for(;(t===void 0||t-- >0)&&!(o=s.next()).done;)f.push(o.value)}catch(g){p={error:g}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(p)throw p.error}}return f},F=function(){for(var h=[],t=0;t<arguments.length;t++)h=h.concat(A(arguments[t]));return h},W=function(){for(var h=0,t=0,n=arguments.length;t<n;t++)h+=arguments[t].length;for(var s=Array(h),o=0,t=0;t<n;t++)for(var f=arguments[t],p=0,g=f.length;p<g;p++,o++)s[o]=f[p];return s},Mt=function(h){return this instanceof Mt?(this.v=h,this):new Mt(h)},Rt=function(h,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(h,t||[]),o,f=[];return o={},p("next"),p("throw"),p("return"),o[Symbol.asyncIterator]=function(){return this},o;function p(_){s[_]&&(o[_]=function(S){return new Promise(function(O,C){f.push([_,S,O,C])>1||g(_,S)})})}function g(_,S){try{c(s[_](S))}catch(O){M(f[0][3],O)}}function c(_){_.value instanceof Mt?Promise.resolve(_.value.v).then(e,u):M(f[0][2],_)}function e(_){g("next",_)}function u(_){g("throw",_)}function M(_,S){_(S),f.shift(),f.length&&g(f[0][0],f[0][1])}},m=function(h){var t,n;return t={},s("next"),s("throw",function(o){throw o}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(o,f){t[o]=h[o]?function(p){return(n=!n)?{value:Mt(h[o](p)),done:o==="return"}:f?f(p):p}:f}},y=function(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=h[Symbol.asyncIterator],n;return t?t.call(h):(h=typeof bt=="function"?bt(h):h[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(f){n[f]=h[f]&&function(p){return new Promise(function(g,c){p=h[f](p),o(g,c,p.done,p.value)})}}function o(f,p,g,c){Promise.resolve(c).then(function(e){f({value:e,done:g})},p)}},b=function(h,t){return Object.defineProperty?Object.defineProperty(h,"raw",{value:t}):h.raw=t,h},w=function(h){if(h&&h.__esModule)return h;var t={};if(h!=null)for(var n in h)Object.hasOwnProperty.call(h,n)&&(t[n]=h[n]);return t.default=h,t},x=function(h){return h&&h.__esModule?h:{default:h}},B=function(h,t){if(!t.has(h))throw new TypeError("attempted to get private field on non-instance");return t.get(h)},k=function(h,t,n){if(!t.has(h))throw new TypeError("attempted to set private field on non-instance");return t.set(h,n),n},E("__extends",r),E("__assign",a),E("__rest",d),E("__decorate",v),E("__param",l),E("__metadata",R),E("__awaiter",T),E("__generator",I),E("__exportStar",U),E("__createBinding",St),E("__values",bt),E("__read",A),E("__spread",F),E("__spreadArrays",W),E("__await",Mt),E("__asyncGenerator",Rt),E("__asyncDelegator",m),E("__asyncValues",y),E("__makeTemplateObject",b),E("__importStar",w),E("__importDefault",x),E("__classPrivateFieldGet",B),E("__classPrivateFieldSet",k)})})(ri);var Tt={},ar;function ni(){if(ar)return Tt;ar=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.isBrowserCryptoAvailable=Tt.getSubtleCrypto=Tt.getBrowerCrypto=void 0;function i(){return(At===null||At===void 0?void 0:At.crypto)||(At===null||At===void 0?void 0:At.msCrypto)||{}}Tt.getBrowerCrypto=i;function r(){const d=i();return d.subtle||d.webkitSubtle}Tt.getSubtleCrypto=r;function a(){return!!i()&&!!r()}return Tt.isBrowserCryptoAvailable=a,Tt}var Ct={},hr;function ii(){if(hr)return Ct;hr=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.isBrowser=Ct.isNode=Ct.isReactNative=void 0;function i(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ct.isReactNative=i;function r(){return typeof Wt<"u"&&typeof Wt.versions<"u"&&typeof Wt.versions.node<"u"}Ct.isNode=r;function a(){return!i()&&!r()}return Ct.isBrowser=a,Ct}(function(i){Object.defineProperty(i,"__esModule",{value:!0});const r=Ee;r.__exportStar(ni(),i),r.__exportStar(ii(),i)})(Zt);function si(i=3){const r=Date.now()*Math.pow(10,i),a=Math.floor(Math.random()*Math.pow(10,i));return r+a}function Vt(i){return Tr(i)}function oi(i){return Vn($t(i))}const ai=si;function _e(){return((r,a)=>{for(a=r="";r++<36;a+=r*51&52?(r^15?8^Math.random()*(r^20?16:4):4).toString(16):"-");return a})()}function hi(i){return i===""||typeof i=="string"&&i.trim()===""}function fi(i){return!(i&&i.length)}function Ar(i,r){return Zn(i,r)}function ci(i){return typeof i.method<"u"}function Gt(i){return typeof i.result<"u"}function Yt(i){return typeof i.error<"u"}function fr(i){return typeof i.event<"u"}function ui(i){return An.includes(i)||i.startsWith("wc_")}function li(i){return i.method.startsWith("wc_")?!0:!Sr.includes(i.method)}function di(i){i=Pt(i.toLowerCase());const r=Pt(Dr.keccak_256(Xn(i)));let a="";for(let d=0;d<i.length;d++)parseInt(r[d],16)>7?a+=i[d].toUpperCase():a+=i[d];return $t(a)}const pi=i=>i?i.toLowerCase().substring(0,2)!=="0x"?!1:/^(0x)?[0-9a-f]{40}$/i.test(i)?/^(0x)?[0-9a-f]{40}$/.test(i)||/^(0x)?[0-9A-F]{40}$/.test(i)?!0:i===di(i):!1:!1;function cr(i){return!fi(i)&&!Ar(i[0])&&(i[0]=ti(i[0])),i}function Me(i){if(typeof i.type<"u"&&i.type!=="0")return i;if(typeof i.from>"u"||!pi(i.from))throw new Error("Transaction object must include a valid 'from' value.");function r(v){let l=v;return(typeof v=="number"||typeof v=="string"&&!hi(v))&&(Ar(v)?typeof v=="string"&&(l=Vt(v)):l=Cr(v)),typeof l=="string"&&(l=oi(l)),l}const a={from:Vt(i.from),to:typeof i.to>"u"?void 0:Vt(i.to),gasPrice:typeof i.gasPrice>"u"?"":r(i.gasPrice),gas:typeof i.gas>"u"?typeof i.gasLimit>"u"?"":r(i.gasLimit):r(i.gas),value:typeof i.value>"u"?"":r(i.value),nonce:typeof i.nonce>"u"?"":r(i.nonce),data:typeof i.data>"u"?"":Vt(i.data)||"0x"},d=["gasPrice","gas","value","nonce"];return Object.keys(a).forEach(v=>{(typeof a[v]>"u"||typeof a[v]=="string"&&!a[v].trim().length)&&d.includes(v)&&delete a[v]}),a}function gi(i){const r=i.message||"Failed or Rejected Request";let a=-32e3;if(i&&!i.code)switch(r){case"Parse error":a=-32700;break;case"Invalid request":a=-32600;break;case"Method not found":a=-32601;break;case"Invalid params":a=-32602;break;case"Internal error":a=-32603;break;default:a=-32e3;break}const d={code:a,message:r};return i.data&&(d.data=i.data),d}var qe={},vi=i=>encodeURIComponent(i).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`),Nr="%[a-f0-9]{2}",ur=new RegExp("("+Nr+")|([^%]+?)","gi"),lr=new RegExp("("+Nr+")+","gi");function Ie(i,r){try{return[decodeURIComponent(i.join(""))]}catch{}if(i.length===1)return i;r=r||1;var a=i.slice(0,r),d=i.slice(r);return Array.prototype.concat.call([],Ie(a),Ie(d))}function mi(i){try{return decodeURIComponent(i)}catch{for(var r=i.match(ur)||[],a=1;a<r.length;a++)i=Ie(r,a).join(""),r=i.match(ur)||[];return i}}function yi(i){for(var r={"%FE%FF":"��","%FF%FE":"��"},a=lr.exec(i);a;){try{r[a[0]]=decodeURIComponent(a[0])}catch{var d=mi(a[0]);d!==a[0]&&(r[a[0]]=d)}a=lr.exec(i)}r["%C2"]="�";for(var v=Object.keys(r),l=0;l<v.length;l++){var R=v[l];i=i.replace(new RegExp(R,"g"),r[R])}return i}var wi=function(i){if(typeof i!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof i+"`");try{return i=i.replace(/\+/g," "),decodeURIComponent(i)}catch{return yi(i)}},_i=(i,r)=>{if(!(typeof i=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(r==="")return[i];const a=i.indexOf(r);return a===-1?[i]:[i.slice(0,a),i.slice(a+r.length)]};(function(i){const r=vi,a=wi,d=_i,v=m=>m==null;function l(m){switch(m.arrayFormat){case"index":return y=>(b,w)=>{const x=b.length;return w===void 0||m.skipNull&&w===null||m.skipEmptyString&&w===""?b:w===null?[...b,[I(y,m),"[",x,"]"].join("")]:[...b,[I(y,m),"[",I(x,m),"]=",I(w,m)].join("")]};case"bracket":return y=>(b,w)=>w===void 0||m.skipNull&&w===null||m.skipEmptyString&&w===""?b:w===null?[...b,[I(y,m),"[]"].join("")]:[...b,[I(y,m),"[]=",I(w,m)].join("")];case"comma":case"separator":return y=>(b,w)=>w==null||w.length===0?b:b.length===0?[[I(y,m),"=",I(w,m)].join("")]:[[b,I(w,m)].join(m.arrayFormatSeparator)];default:return y=>(b,w)=>w===void 0||m.skipNull&&w===null||m.skipEmptyString&&w===""?b:w===null?[...b,I(y,m)]:[...b,[I(y,m),"=",I(w,m)].join("")]}}function R(m){let y;switch(m.arrayFormat){case"index":return(b,w,x)=>{if(y=/\[(\d*)\]$/.exec(b),b=b.replace(/\[\d*\]$/,""),!y){x[b]=w;return}x[b]===void 0&&(x[b]={}),x[b][y[1]]=w};case"bracket":return(b,w,x)=>{if(y=/(\[\])$/.exec(b),b=b.replace(/\[\]$/,""),!y){x[b]=w;return}if(x[b]===void 0){x[b]=[w];return}x[b]=[].concat(x[b],w)};case"comma":case"separator":return(b,w,x)=>{const k=typeof w=="string"&&w.split("").indexOf(m.arrayFormatSeparator)>-1?w.split(m.arrayFormatSeparator).map(St=>U(St,m)):w===null?w:U(w,m);x[b]=k};default:return(b,w,x)=>{if(x[b]===void 0){x[b]=w;return}x[b]=[].concat(x[b],w)}}}function T(m){if(typeof m!="string"||m.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function I(m,y){return y.encode?y.strict?r(m):encodeURIComponent(m):m}function U(m,y){return y.decode?a(m):m}function bt(m){return Array.isArray(m)?m.sort():typeof m=="object"?bt(Object.keys(m)).sort((y,b)=>Number(y)-Number(b)).map(y=>m[y]):m}function A(m){const y=m.indexOf("#");return y!==-1&&(m=m.slice(0,y)),m}function F(m){let y="";const b=m.indexOf("#");return b!==-1&&(y=m.slice(b)),y}function W(m){m=A(m);const y=m.indexOf("?");return y===-1?"":m.slice(y+1)}function Mt(m,y){return y.parseNumbers&&!Number.isNaN(Number(m))&&typeof m=="string"&&m.trim()!==""?m=Number(m):y.parseBooleans&&m!==null&&(m.toLowerCase()==="true"||m.toLowerCase()==="false")&&(m=m.toLowerCase()==="true"),m}function Rt(m,y){y=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},y),T(y.arrayFormatSeparator);const b=R(y),w=Object.create(null);if(typeof m!="string"||(m=m.trim().replace(/^[?#&]/,""),!m))return w;for(const x of m.split("&")){let[B,k]=d(y.decode?x.replace(/\+/g," "):x,"=");k=k===void 0?null:["comma","separator"].includes(y.arrayFormat)?k:U(k,y),b(U(B,y),k,w)}for(const x of Object.keys(w)){const B=w[x];if(typeof B=="object"&&B!==null)for(const k of Object.keys(B))B[k]=Mt(B[k],y);else w[x]=Mt(B,y)}return y.sort===!1?w:(y.sort===!0?Object.keys(w).sort():Object.keys(w).sort(y.sort)).reduce((x,B)=>{const k=w[B];return k&&typeof k=="object"&&!Array.isArray(k)?x[B]=bt(k):x[B]=k,x},Object.create(null))}i.extract=W,i.parse=Rt,i.stringify=(m,y)=>{if(!m)return"";y=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},y),T(y.arrayFormatSeparator);const b=k=>y.skipNull&&v(m[k])||y.skipEmptyString&&m[k]==="",w=l(y),x={};for(const k of Object.keys(m))b(k)||(x[k]=m[k]);const B=Object.keys(x);return y.sort!==!1&&B.sort(y.sort),B.map(k=>{const St=m[k];return St===void 0?"":St===null?I(k,y):Array.isArray(St)?St.reduce(w(k),[]).join("&"):I(k,y)+"="+I(St,y)}).filter(k=>k.length>0).join("&")},i.parseUrl=(m,y)=>{y=Object.assign({decode:!0},y);const[b,w]=d(m,"#");return Object.assign({url:b.split("?")[0]||"",query:Rt(W(m),y)},y&&y.parseFragmentIdentifier&&w?{fragmentIdentifier:U(w,y)}:{})},i.stringifyUrl=(m,y)=>{y=Object.assign({encode:!0,strict:!0},y);const b=A(m.url).split("?")[0]||"",w=i.extract(m.url),x=i.parse(w,{sort:!1}),B=Object.assign(x,m.query);let k=i.stringify(B,y);k&&(k=`?${k}`);let St=F(m.url);return m.fragmentIdentifier&&(St=`#${I(m.fragmentIdentifier,y)}`),`${b}${k}${St}`}})(qe);function Mi(i){const r=i.indexOf("?")!==-1?i.indexOf("?"):void 0;return typeof r<"u"?i.substr(r):""}function bi(i,r){let a=qr(i);return a=Object.assign(Object.assign({},a),r),i=Si(a),i}function qr(i){return qe.parse(i)}function Si(i){return qe.stringify(i)}function Ri(i){return typeof i.bridge<"u"}function Ei(i){const r=i.indexOf(":"),a=i.indexOf("?")!==-1?i.indexOf("?"):void 0,d=i.substring(0,r),v=i.substring(r+1,a);function l(A){const F="@",W=A.split(F);return{handshakeTopic:W[0],version:parseInt(W[1],10)}}const R=l(v),T=typeof a<"u"?i.substr(a):"";function I(A){const F=qr(A);return{key:F.key||"",bridge:F.bridge||""}}const U=I(T);return Object.assign(Object.assign({protocol:d},R),U)}class Ii{constructor(){this._eventEmitters=[],typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",()=>this.trigger("online")),window.addEventListener("offline",()=>this.trigger("offline")))}on(r,a){this._eventEmitters.push({event:r,callback:a})}trigger(r){let a=[];r&&(a=this._eventEmitters.filter(d=>d.event===r)),a.forEach(d=>{d.callback()})}}const Oi=typeof Xe.WebSocket<"u"?Xe.WebSocket:require("ws");class xi{constructor(r){if(this.opts=r,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=r.protocol,this._version=r.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=r.subscriptions||[],this._netMonitor=r.netMonitor||new Ii,!r.url||typeof r.url!="string")throw new Error("Missing or invalid WebSocket url");this._url=r.url,this._netMonitor.on("online",()=>this._socketCreate())}set readyState(r){}get readyState(){return this._socket?this._socket.readyState:-1}set connecting(r){}get connecting(){return this.readyState===0}set connected(r){}get connected(){return this.readyState===1}set closing(r){}get closing(){return this.readyState===2}set closed(r){}get closed(){return this.readyState===3}open(){this._socketCreate()}close(){this._socketClose()}send(r,a,d){if(!a||typeof a!="string")throw new Error("Missing or invalid topic field");this._socketSend({topic:a,type:"pub",payload:r,silent:!!d})}subscribe(r){this._socketSend({topic:r,type:"sub",payload:"",silent:!0})}on(r,a){this._events.push({event:r,callback:a})}_socketCreate(){if(this._nextSocket)return;const r=ki(this._url,this._protocol,this._version);if(this._nextSocket=new Oi(r),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=a=>this._socketReceive(a),this._nextSocket.onopen=()=>this._socketOpen(),this._nextSocket.onerror=a=>this._socketError(a),this._nextSocket.onclose=()=>{setTimeout(()=>{this._nextSocket=null,this._socketCreate()},1e3)}}_socketOpen(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}_socketClose(){this._socket&&(this._socket.onclose=()=>{},this._socket.close())}_socketSend(r){const a=JSON.stringify(r);this._socket&&this._socket.readyState===1?this._socket.send(a):(this._setToQueue(r),this._socketCreate())}async _socketReceive(r){let a;try{a=JSON.parse(r.data)}catch{return}if(this._socketSend({topic:a.topic,type:"ack",payload:"",silent:!0}),this._socket&&this._socket.readyState===1){const d=this._events.filter(v=>v.event==="message");d&&d.length&&d.forEach(v=>v.callback(a))}}_socketError(r){const a=this._events.filter(d=>d.event==="error");a&&a.length&&a.forEach(d=>d.callback(r))}_queueSubscriptions(){this._subscriptions.forEach(a=>this._queue.push({topic:a,type:"sub",payload:"",silent:!0})),this._subscriptions=this.opts.subscriptions||[]}_setToQueue(r){this._queue.push(r)}_pushQueue(){this._queue.forEach(a=>this._socketSend(a)),this._queue=[]}}function ki(i,r,a){var d,v;const R=(i.startsWith("https")?i.replace("https","wss"):i.startsWith("http")?i.replace("http","ws"):i).split("?"),T=Rn()?{protocol:r,version:a,env:"browser",host:((d=In())===null||d===void 0?void 0:d.host)||""}:{protocol:r,version:a,env:((v=ke())===null||v===void 0?void 0:v.name)||""},I=bi(Mi(R[1]||""),T);return R[0]+"?"+I}const be="Session currently connected",Lt="Session currently disconnected",Ti="Session Rejected",Ci="Missing JSON RPC response",Ai='JSON-RPC success response must include "result" field',Ni='JSON-RPC error response must include "error" field',qi='JSON RPC request must have valid "method" value',Pi='JSON RPC request must have valid "id" value',Bi="Missing one of the required parameters: bridge / uri / session",dr="JSON RPC response format is invalid",Li="URI format is invalid",Wi="QRCode Modal not provided",pr="User close QRCode Modal";class Ui{constructor(){this._eventEmitters=[]}subscribe(r){this._eventEmitters.push(r)}unsubscribe(r){this._eventEmitters=this._eventEmitters.filter(a=>a.event!==r)}trigger(r){let a=[],d;ci(r)?d=r.method:Gt(r)||Yt(r)?d=`response:${r.id}`:fr(r)?d=r.event:d="",d&&(a=this._eventEmitters.filter(v=>v.event===d)),(!a||!a.length)&&!ui(d)&&!fr(d)&&(a=this._eventEmitters.filter(v=>v.event==="call_request")),a.forEach(v=>{if(Yt(r)){const l=new Error(r.error.message);v.callback(l,null)}else v.callback(null,r)})}}class Fi{constructor(r="walletconnect"){this.storageId=r}getSession(){let r=null;const a=Mr(this.storageId);return a&&Ri(a)&&(r=a),r}setSession(r){return Cn(this.storageId,r),r}removeSession(){br(this.storageId)}}const ji="walletconnect.org",Di="abcdefghijklmnopqrstuvwxyz0123456789",Pr=Di.split("").map(i=>`https://${i}.bridge.walletconnect.org`);function Hi(i){let r=i.indexOf("//")>-1?i.split("/")[2]:i.split("/")[0];return r=r.split(":")[0],r=r.split("?")[0],r}function $i(i){return Hi(i).split(".").slice(-2).join(".")}function Zi(){return Math.floor(Math.random()*Pr.length)}function Ji(){return Pr[Zi()]}function Gi(i){return $i(i)===ji}function Ki(i){return Gi(i)?Ji():i}class Vi{constructor(r){if(this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new Ui,this._clientMeta=sr()||r.connectorOpts.clientMeta||null,this._cryptoLib=r.cryptoLib,this._sessionStorage=r.sessionStorage||new Fi(r.connectorOpts.storageId),this._qrcodeModal=r.connectorOpts.qrcodeModal,this._qrcodeModalOptions=r.connectorOpts.qrcodeModalOptions,this._signingMethods=[...Sr,...r.connectorOpts.signingMethods||[]],!r.connectorOpts.bridge&&!r.connectorOpts.uri&&!r.connectorOpts.session)throw new Error(Bi);r.connectorOpts.bridge&&(this.bridge=Ki(r.connectorOpts.bridge)),r.connectorOpts.uri&&(this.uri=r.connectorOpts.uri);const a=r.connectorOpts.session||this._getStorageSession();a&&(this.session=a),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=r.transport||new xi({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),r.connectorOpts.uri&&this._subscribeToSessionRequest(),r.pushServerOpts&&this._registerPushServer(r.pushServerOpts)}set bridge(r){r&&(this._bridge=r)}get bridge(){return this._bridge}set key(r){if(!r)return;const a=ei(r);this._key=a}get key(){return this._key?Qn(this._key,!0):""}set clientId(r){r&&(this._clientId=r)}get clientId(){let r=this._clientId;return r||(r=this._clientId=_e()),this._clientId}set peerId(r){r&&(this._peerId=r)}get peerId(){return this._peerId}set clientMeta(r){}get clientMeta(){let r=this._clientMeta;return r||(r=this._clientMeta=sr()),r}set peerMeta(r){this._peerMeta=r}get peerMeta(){return this._peerMeta}set handshakeTopic(r){r&&(this._handshakeTopic=r)}get handshakeTopic(){return this._handshakeTopic}set handshakeId(r){r&&(this._handshakeId=r)}get handshakeId(){return this._handshakeId}get uri(){return this._formatUri()}set uri(r){if(!r)return;const{handshakeTopic:a,bridge:d,key:v}=this._parseUri(r);this.handshakeTopic=a,this.bridge=d,this.key=v}set chainId(r){this._chainId=r}get chainId(){return this._chainId}set networkId(r){this._networkId=r}get networkId(){return this._networkId}set accounts(r){this._accounts=r}get accounts(){return this._accounts}set rpcUrl(r){this._rpcUrl=r}get rpcUrl(){return this._rpcUrl}set connected(r){}get connected(){return this._connected}set pending(r){}get pending(){return!!this._handshakeTopic}get session(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}}set session(r){r&&(this._connected=r.connected,this.accounts=r.accounts,this.chainId=r.chainId,this.bridge=r.bridge,this.key=r.key,this.clientId=r.clientId,this.clientMeta=r.clientMeta,this.peerId=r.peerId,this.peerMeta=r.peerMeta,this.handshakeId=r.handshakeId,this.handshakeTopic=r.handshakeTopic)}on(r,a){const d={event:r,callback:a};this._eventManager.subscribe(d)}off(r){this._eventManager.unsubscribe(r)}async createInstantRequest(r){this._key=await this._generateKey();const a=this._formatRequest({method:"wc_instantRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,request:this._formatRequest(r)}]});this.handshakeId=a.id,this.handshakeTopic=_e(),this._eventManager.trigger({event:"display_uri",params:[this.uri]}),this.on("modal_closed",()=>{throw new Error(pr)});const d=()=>{this.killSession()};try{const v=await this._sendCallRequest(a);return v&&d(),v}catch(v){throw d(),v}}async connect(r){if(!this._qrcodeModal)throw new Error(Wi);return this.connected?{chainId:this.chainId,accounts:this.accounts}:(await this.createSession(r),new Promise(async(a,d)=>{this.on("modal_closed",()=>d(new Error(pr))),this.on("connect",(v,l)=>{if(v)return d(v);a(l.params[0])})}))}async createSession(r){if(this._connected)throw new Error(be);if(this.pending)return;this._key=await this._generateKey();const a=this._formatRequest({method:"wc_sessionRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,chainId:r&&r.chainId?r.chainId:null}]});this.handshakeId=a.id,this.handshakeTopic=_e(),this._sendSessionRequest(a,"Session update rejected",{topic:this.handshakeTopic}),this._eventManager.trigger({event:"display_uri",params:[this.uri]})}approveSession(r){if(this._connected)throw new Error(be);this.chainId=r.chainId,this.accounts=r.accounts,this.networkId=r.networkId||0,this.rpcUrl=r.rpcUrl||"";const a={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta},d={id:this.handshakeId,jsonrpc:"2.0",result:a};this._sendResponse(d),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}rejectSession(r){if(this._connected)throw new Error(be);const a=r&&r.message?r.message:Ti,d=this._formatResponse({id:this.handshakeId,error:{message:a}});this._sendResponse(d),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:a}]}),this._removeStorageSession()}updateSession(r){if(!this._connected)throw new Error(Lt);this.chainId=r.chainId,this.accounts=r.accounts,this.networkId=r.networkId||0,this.rpcUrl=r.rpcUrl||"";const a={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl},d=this._formatRequest({method:"wc_sessionUpdate",params:[a]});this._sendSessionRequest(d,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}async killSession(r){const a=r?r.message:"Session Disconnected",d={approved:!1,chainId:null,networkId:null,accounts:null},v=this._formatRequest({method:"wc_sessionUpdate",params:[d]});await this._sendRequest(v),this._handleSessionDisconnect(a)}async sendTransaction(r){if(!this._connected)throw new Error(Lt);const a=Me(r),d=this._formatRequest({method:"eth_sendTransaction",params:[a]});return await this._sendCallRequest(d)}async signTransaction(r){if(!this._connected)throw new Error(Lt);const a=Me(r),d=this._formatRequest({method:"eth_signTransaction",params:[a]});return await this._sendCallRequest(d)}async signMessage(r){if(!this._connected)throw new Error(Lt);const a=this._formatRequest({method:"eth_sign",params:r});return await this._sendCallRequest(a)}async signPersonalMessage(r){if(!this._connected)throw new Error(Lt);r=cr(r);const a=this._formatRequest({method:"personal_sign",params:r});return await this._sendCallRequest(a)}async signTypedData(r){if(!this._connected)throw new Error(Lt);const a=this._formatRequest({method:"eth_signTypedData",params:r});return await this._sendCallRequest(a)}async updateChain(r){if(!this._connected)throw new Error("Session currently disconnected");const a=this._formatRequest({method:"wallet_updateChain",params:[r]});return await this._sendCallRequest(a)}unsafeSend(r,a){return this._sendRequest(r,a),this._eventManager.trigger({event:"call_request_sent",params:[{request:r,options:a}]}),new Promise((d,v)=>{this._subscribeToResponse(r.id,(l,R)=>{if(l){v(l);return}if(!R)throw new Error(Ci);d(R)})})}async sendCustomRequest(r,a){if(!this._connected)throw new Error(Lt);switch(r.method){case"eth_accounts":return this.accounts;case"eth_chainId":return Cr(this.chainId);case"eth_sendTransaction":case"eth_signTransaction":r.params&&(r.params[0]=Me(r.params[0]));break;case"personal_sign":r.params&&(r.params=cr(r.params));break}const d=this._formatRequest(r);return await this._sendCallRequest(d,a)}approveRequest(r){if(Gt(r)){const a=this._formatResponse(r);this._sendResponse(a)}else throw new Error(Ai)}rejectRequest(r){if(Yt(r)){const a=this._formatResponse(r);this._sendResponse(a)}else throw new Error(Ni)}transportClose(){this._transport.close()}async _sendRequest(r,a){const d=this._formatRequest(r),v=await this._encrypt(d),l=typeof a?.topic<"u"?a.topic:this.peerId,R=JSON.stringify(v),T=typeof a?.forcePushNotification<"u"?!a.forcePushNotification:li(d);this._transport.send(R,l,T)}async _sendResponse(r){const a=await this._encrypt(r),d=this.peerId,v=JSON.stringify(a),l=!0;this._transport.send(v,d,l)}async _sendSessionRequest(r,a,d){this._sendRequest(r,d),this._subscribeToSessionResponse(r.id,a)}_sendCallRequest(r,a){return this._sendRequest(r,a),this._eventManager.trigger({event:"call_request_sent",params:[{request:r,options:a}]}),this._subscribeToCallResponse(r.id)}_formatRequest(r){if(typeof r.method>"u")throw new Error(qi);return{id:typeof r.id>"u"?ai():r.id,jsonrpc:"2.0",method:r.method,params:typeof r.params>"u"?[]:r.params}}_formatResponse(r){if(typeof r.id>"u")throw new Error(Pi);const a={id:r.id,jsonrpc:"2.0"};if(Yt(r)){const d=gi(r.error);return Object.assign(Object.assign(Object.assign({},a),r),{error:d})}else if(Gt(r))return Object.assign(Object.assign({},a),r);throw new Error(dr)}_handleSessionDisconnect(r){const a=r||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),br(or)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:a}]}),this._removeStorageSession(),this.transportClose()}_handleSessionResponse(r,a){a?a.approved?(this._connected?(a.chainId&&(this.chainId=a.chainId),a.accounts&&(this.accounts=a.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,a.chainId&&(this.chainId=a.chainId),a.accounts&&(this.accounts=a.accounts),a.peerId&&!this.peerId&&(this.peerId=a.peerId),a.peerMeta&&!this.peerMeta&&(this.peerMeta=a.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(r):this._handleSessionDisconnect(r)}async _handleIncomingMessages(r){if(![this.clientId,this.handshakeTopic].includes(r.topic))return;let d;try{d=JSON.parse(r.payload)}catch{return}const v=await this._decrypt(d);v&&this._eventManager.trigger(v)}_subscribeToSessionRequest(){this._transport.subscribe(this.handshakeTopic)}_subscribeToResponse(r,a){this.on(`response:${r}`,a)}_subscribeToSessionResponse(r,a){this._subscribeToResponse(r,(d,v)=>{if(d){this._handleSessionResponse(d.message);return}Gt(v)?this._handleSessionResponse(a,v.result):v.error&&v.error.message?this._handleSessionResponse(v.error.message):this._handleSessionResponse(a)})}_subscribeToCallResponse(r){return new Promise((a,d)=>{this._subscribeToResponse(r,(v,l)=>{if(v){d(v);return}Gt(l)?a(l.result):l.error&&l.error.message?d(l.error):d(new Error(dr))})})}_subscribeToInternalEvents(){this.on("display_uri",()=>{this._qrcodeModal&&this._qrcodeModal.open(this.uri,()=>{this._eventManager.trigger({event:"modal_closed",params:[]})},this._qrcodeModalOptions)}),this.on("connect",()=>{this._qrcodeModal&&this._qrcodeModal.close()}),this.on("call_request_sent",(r,a)=>{const{request:d}=a.params[0];if(bn()&&this._signingMethods.includes(d.method)){const v=Mr(or);v&&(window.location.href=v.href)}}),this.on("wc_sessionRequest",(r,a)=>{r&&this._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:r.toString()}]}),this.handshakeId=a.id,this.peerId=a.params[0].peerId,this.peerMeta=a.params[0].peerMeta;const d=Object.assign(Object.assign({},a),{method:"session_request"});this._eventManager.trigger(d)}),this.on("wc_sessionUpdate",(r,a)=>{r&&this._handleSessionResponse(r.message),this._handleSessionResponse("Session disconnected",a.params[0])})}_initTransport(){this._transport.on("message",r=>this._handleIncomingMessages(r)),this._transport.on("open",()=>this._eventManager.trigger({event:"transport_open",params:[]})),this._transport.on("close",()=>this._eventManager.trigger({event:"transport_close",params:[]})),this._transport.on("error",()=>this._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})),this._transport.open()}_formatUri(){const r=this.protocol,a=this.handshakeTopic,d=this.version,v=encodeURIComponent(this.bridge),l=this.key;return`${r}:${a}@${d}?bridge=${v}&key=${l}`}_parseUri(r){const a=Ei(r);if(a.protocol===this.protocol){if(!a.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");const d=a.handshakeTopic;if(!a.bridge)throw Error("Invalid or missing bridge url parameter value");const v=decodeURIComponent(a.bridge);if(!a.key)throw Error("Invalid or missing key parameter value");const l=a.key;return{handshakeTopic:d,bridge:v,key:l}}else throw new Error(Li)}async _generateKey(){return this._cryptoLib?await this._cryptoLib.generateKey():null}async _encrypt(r){const a=this._key;return this._cryptoLib&&a?await this._cryptoLib.encrypt(r,a):null}async _decrypt(r){const a=this._key;return this._cryptoLib&&a?await this._cryptoLib.decrypt(r,a):null}_getStorageSession(){let r=null;return this._sessionStorage&&(r=this._sessionStorage.getSession()),r}_setStorageSession(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}_removeStorageSession(){this._sessionStorage&&this._sessionStorage.removeSession()}_manageStorageSession(){this._connected?this._setStorageSession():this._removeStorageSession()}_registerPushServer(r){if(!r.url||typeof r.url!="string")throw Error("Invalid or missing pushServerOpts.url parameter value");if(!r.type||typeof r.type!="string")throw Error("Invalid or missing pushServerOpts.type parameter value");if(!r.token||typeof r.token!="string")throw Error("Invalid or missing pushServerOpts.token parameter value");const a={bridge:this.bridge,topic:this.clientId,type:r.type,token:r.token,peerName:"",language:r.language||""};this.on("connect",async(d,v)=>{if(d)throw d;if(r.peerMeta){const l=v.params[0].peerMeta.name;a.peerName=l}try{if(!(await(await fetch(`${r.url}/new`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)})).json()).success)throw Error("Failed to register in Push Server")}catch{throw Error("Failed to register in Push Server")}})}}function zi(i){return Zt.getBrowerCrypto().getRandomValues(new Uint8Array(i))}const Br=256,Lr=Br,Qi=Br,Bt="AES-CBC",Yi=`SHA-${Lr}`,Oe="HMAC",Xi="encrypt",ts="decrypt",es="sign",rs="verify";function ns(i){return i===Bt?{length:Lr,name:Bt}:{hash:{name:Yi},name:Oe}}function is(i){return i===Bt?[Xi,ts]:[es,rs]}async function Pe(i,r=Bt){return Zt.getSubtleCrypto().importKey("raw",i,ns(r),!0,is(r))}async function ss(i,r,a){const d=Zt.getSubtleCrypto(),v=await Pe(r,Bt),l=await d.encrypt({iv:i,name:Bt},v,a);return new Uint8Array(l)}async function os(i,r,a){const d=Zt.getSubtleCrypto(),v=await Pe(r,Bt),l=await d.decrypt({iv:i,name:Bt},v,a);return new Uint8Array(l)}async function as(i,r){const a=Zt.getSubtleCrypto(),d=await Pe(i,Oe),v=await a.sign({length:Qi,name:Oe},d,r);return new Uint8Array(v)}function hs(i,r,a){return ss(i,r,a)}function fs(i,r,a){return os(i,r,a)}async function Wr(i,r){return await as(i,r)}async function Ur(i){const r=(i||256)/8,a=zi(r);return Yn(te(a))}async function Fr(i,r){const a=jt(i.data),d=jt(i.iv),v=jt(i.hmac),l=Ft(v,!1),R=kr(a,d),T=await Wr(r,R),I=Ft(T,!1);return Pt(l)===Pt(I)}async function cs(i,r,a){const d=Dt(Re(r)),v=a||await Ur(128),l=Dt(Re(v)),R=Ft(l,!1),T=JSON.stringify(i),I=Hn(T),U=await hs(l,d,I),bt=Ft(U,!1),A=kr(U,l),F=await Wr(d,A),W=Ft(F,!1);return{data:bt,hmac:W,iv:R}}async function us(i,r){const a=Dt(Re(r));if(!a)throw new Error("Missing key: required for decryption");if(!await Fr(i,a))return null;const v=jt(i.data),l=jt(i.iv),R=await fs(l,a,v),T=jn(R);let I;try{I=JSON.parse(T)}catch{return null}return I}const ls=Object.freeze(Object.defineProperty({__proto__:null,decrypt:us,encrypt:cs,generateKey:Ur,verifyHmac:Fr},Symbol.toStringTag,{value:"Module"}));class ds extends Vi{constructor(r,a){super({cryptoLib:ls,connectorOpts:r,pushServerOpts:a})}}const gr=[{name:"Rainbow",chains:[Qt.EIP155],logo:"https://images.web3auth.io/login-rainbow.svg",mobile:{native:"rainbow:",universal:"https://rnbwapp.com"},desktop:{native:"",universal:""}},{name:"MetaMask",chains:[Qt.EIP155],logo:"https://images.web3auth.io/login-metamask.svg",mobile:{native:"metamask:",universal:"https://metamask.app.link"},desktop:{native:"",universal:""}}];function vr(i,r){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);r&&(d=d.filter(function(v){return Object.getOwnPropertyDescriptor(i,v).enumerable})),a.push.apply(a,d)}return a}function ps(i){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?vr(Object(a),!0).forEach(function(d){xt(i,d,a[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):vr(Object(a)).forEach(function(d){Object.defineProperty(i,d,Object.getOwnPropertyDescriptor(a,d))})}return i}class ys extends Gr{constructor(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(r),xt(this,"name",Jt.WALLET_CONNECT_V1),xt(this,"adapterNamespace",Hr.EIP155),xt(this,"currentChainNamespace",Qt.EIP155),xt(this,"type",$r.EXTERNAL),xt(this,"adapterOptions",void 0),xt(this,"status",It.NOT_READY),xt(this,"adapterData",{uri:"",extensionAdapters:gr}),xt(this,"connector",null),xt(this,"wcProvider",null),this.adapterOptions=ps({},r)}get connected(){var r;return!!((r=this.connector)!==null&&r!==void 0&&r.connected)}get provider(){var r;return((r=this.wcProvider)===null||r===void 0?void 0:r.provider)||null}set provider(r){throw new Error("Not implemented")}async init(){await super.init(),super.checkInitializationRequirements(),this.connector=this.getWalletConnectInstance(),this.wcProvider=new tr({config:{chainConfig:this.chainConfig},connector:this.connector}),this.emit(Ot.READY,Jt.WALLET_CONNECT_V1),this.status=It.READY,qt.debug("initializing wallet connect v1 adapter"),this.connector.connected&&(this.rehydrated=!0,await this.onConnectHandler({accounts:this.connector.accounts,chainId:this.connector.chainId}))}async connect(){if(super.checkConnectionRequirements(),!this.connector)throw kt.notReady("Wallet adapter is not ready yet");if(this.connected)return await this.onConnectHandler({accounts:this.connector.accounts,chainId:this.connector.chainId}),this.provider;if(this.status!==It.CONNECTING){var r;if((r=this.adapterOptions.adapterSettings)!==null&&r!==void 0&&r.qrcodeModal){var a;this.connector=this.getWalletConnectInstance(),this.wcProvider=new tr({config:{chainConfig:this.chainConfig,skipLookupNetwork:(a=this.adapterOptions.adapterSettings)===null||a===void 0?void 0:a.skipNetworkSwitching},connector:this.connector})}await this.createNewSession(),this.status=It.CONNECTING,this.emit(Ot.CONNECTING,{adapter:Jt.WALLET_CONNECT_V1})}return new Promise((d,v)=>{if(!this.connector){v(kt.notReady("Wallet adapter is not ready yet"));return}this.connector.on("modal_closed",async()=>(this.status=It.READY,this.emit(Ot.READY,Jt.WALLET_CONNECT_V1),v(new Error("User closed modal"))));try{this.connector.on("connect",async(l,R)=>(l&&this.emit(Ot.ERRORED,l),qt.debug("connected event emitted by web3auth"),await this.onConnectHandler(R.params[0]),d(this.provider)))}catch(l){qt.error("Wallet connect v1 adapter error while connecting",l),this.status=It.READY,this.rehydrated=!0,this.emit(Ot.ERRORED,l),v(l instanceof Zr?l:Kt.connectionError(`Failed to login with wallet connect: ${l?.message||""}`))}})}async getUserInfo(){if(!this.connected)throw Kt.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async disconnect(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};await super.disconnectSession();const{cleanup:a}=r;if(!this.connector||!this.connected)throw Kt.notConnectedError("Not connected with wallet");await this.connector.killSession(),this.rehydrated=!1,a?(this.connector=null,this.status=It.NOT_READY,this.wcProvider=null):this.status=It.READY,await super.disconnect()}async addChain(r){try{var a;if(!this.wcProvider)throw kt.notReady("Wallet adapter is not ready yet");const d=(a=this.adapterOptions.adapterSettings)===null||a===void 0?void 0:a.networkSwitchModal;d&&await d.addNetwork({chainConfig:r,appOrigin:window.location.hostname}),await this.wcProvider.addChain(r)}catch(d){qt.error(d)}}async switchChain(r,a){var d;if(!this.wcProvider)throw kt.notReady("Wallet adapter is not ready yet");const v=(d=this.adapterOptions.adapterSettings)===null||d===void 0?void 0:d.networkSwitchModal;v&&await v.switchNetwork({currentChainConfig:a,newChainConfig:r,appOrigin:window.location.hostname}),await this.wcProvider.switchChain({chainId:a.chainId,lookup:!1,addChain:!1})}async createNewSession(){var r,a;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{forceNewSession:!1};if(!this.connector)throw kt.notReady("Wallet adapter is not ready yet");if(d.forceNewSession&&this.connector.pending&&await this.connector.killSession(),(r=this.adapterOptions)!==null&&r!==void 0&&(a=r.adapterSettings)!==null&&a!==void 0&&a.qrcodeModal){var v;await this.connector.createSession({chainId:parseInt(((v=this.chainConfig)===null||v===void 0?void 0:v.chainId)||"0x1",16)});return}return new Promise((l,R)=>{var T;if(!this.connector){R(kt.notReady("Wallet adapter is not ready yet"));return}qt.debug("creating new session for web3auth wallet connect"),this.connector.on("display_uri",async(I,U)=>{var bt;if(I)return this.emit(Ot.ERRORED,Kt.connectionError("Failed to display wallet connect qr code")),R(I);const A=U.params[0];return this.updateAdapterData({uri:A,extensionAdapters:gr}),(bt=this.connector)===null||bt===void 0||bt.off("display_uri"),l()}),this.connector.createSession({chainId:parseInt(((T=this.chainConfig)===null||T===void 0?void 0:T.chainId)||"0x1",16)}).catch(I=>(qt.error("error while creating new wallet connect session",I),this.emit(Ot.ERRORED,I),R(I)))})}async onConnectHandler(r){if(!this.connector||!this.wcProvider)throw kt.notReady("Wallet adapter is not ready yet");if(!this.chainConfig)throw kt.invalidParams("Chain config is not set");const{chainId:a}=r;if(qt.debug("connected chainId in hex"),a!==parseInt(this.chainConfig.chainId,16)){var d,v,l;const R=Jr(Qt.EIP155,a)||{chainId:`0x${a.toString(16)}`,displayName:"Unknown Network"},T=(d=this.adapterOptions.adapterSettings)===null||d===void 0?void 0:d.qrcodeModal;if(!T||T&&!((v=this.adapterOptions)!==null&&v!==void 0&&(l=v.adapterSettings)!==null&&l!==void 0&&l.skipNetworkSwitching))try{await this.addChain(this.chainConfig),await this.switchChain(R,this.chainConfig),this.connector=this.getWalletConnectInstance()}catch(I){qt.error("error while chain switching",I),await this.createNewSession({forceNewSession:!0}),this.emit(Ot.ERRORED,kt.fromCode(5e3,`Not connected to correct network. Expected: ${this.chainConfig.displayName}, Current: ${R?.displayName||a}, Please switch to correct network from wallet`)),this.status=It.READY,this.rehydrated=!0;return}}await this.wcProvider.setupProvider(this.connector),this.subscribeEvents(this.connector),this.status=It.CONNECTED,this.emit(Ot.CONNECTED,{adapter:Jt.WALLET_CONNECT_V1,reconnected:this.rehydrated})}subscribeEvents(r){r.on("session_update",async a=>{a&&this.emit(Ot.ERRORED,a)})}getWalletConnectInstance(){const r=this.adapterOptions.adapterSettings||{};return r.bridge=r.bridge||"https://bridge.walletconnect.org",new ds(r)}}export{ys as WalletConnectV1Adapter};
